import{a as q}from"./chunk-ZJ5CSXJS.js";import{c as G,f as B,i as z,j as H,k as P,o as W}from"./chunk-SMCZ5Z56.js";import{a as $}from"./chunk-5T4VIS3M.js";import{$a as N,Cb as L,Db as D,Ga as x,Gb as A,Ia as d,Ka as U,Ma as t,Na as r,O as C,Oa as c,Pa as k,Qa as M,Ra as f,T as I,Va as V,W as R,Wa as i,Xa as b,Ya as h,_a as T,ab as F,ca as S,cb as O,da as v,ea as p,fa as u,ib as j,wa as a,xa as _}from"./chunk-V3AN2ELD.js";import{a as w,b as E,h as m}from"./chunk-FK42CRUA.js";var y=class o{constructor(n){this.supabase=n}TABLE="roles";getRoles(){return m(this,null,function*(){let{data:n,error:e}=yield this.supabase.client.from(this.TABLE).select("*").order("id_rol",{ascending:!0});if(e)throw e;return n})}static \u0275fac=function(e){return new(e||o)(I($))};static \u0275prov=C({token:o,factory:o.\u0275fac,providedIn:"root"})};function X(o,n){o&1&&(t(0,"div",20),i(1,"Cargando usuarios..."),r())}function Y(o,n){if(o&1&&(t(0,"option",30),i(1),r()),o&2){let e=n.$implicit;d("ngValue",e.id_rol),a(),h(" ",e.nombre_rol," ")}}function Z(o,n){if(o&1){let e=k();t(0,"tr",24)(1,"td",25),i(2),r(),t(3,"td",26),i(4),r(),t(5,"td",26),i(6),r(),t(7,"td",27)(8,"span",28),i(9),r()(),t(10,"td",27)(11,"select",29),F("ngModelChange",function(s){let g=S(e).$implicit;return N(g.id_rol,s)||(g.id_rol=s),v(s)}),t(12,"option",30),i(13,"SIN ROL"),r(),x(14,Y,2,2,"option",31),r()(),t(15,"td",27)(16,"div",32)(17,"button",33),M("click",function(){let s=S(e).$implicit,g=f(2);return v(g.guardarRol(s))}),p(),t(18,"svg",34),c(19,"path",35),r(),u(),t(20,"span"),i(21,"Guardar"),r()()()()()}if(o&2){let e=n.$implicit,l=f(2);a(2),b(e.nombre_usuario),a(2),b(e.nombre||"-"),a(2),b(e.apellido||"-"),a(2),U("bg-blue-100",e.roles==null?null:e.roles.nombre_rol)("text-blue-700",e.roles==null?null:e.roles.nombre_rol)("bg-gray-100",!(e.roles!=null&&e.roles.nombre_rol))("text-gray-700",!(e.roles!=null&&e.roles.nombre_rol)),a(),h(" ",(e.roles==null?null:e.roles.nombre_rol)||"SIN ROL"," "),a(2),T("ngModel",e.id_rol),a(),d("ngValue",null),a(2),d("ngForOf",l.roles)}}function ee(o,n){if(o&1&&(t(0,"table",21)(1,"thead")(2,"tr")(3,"th",22),i(4,"Usuario"),r(),t(5,"th",22),i(6,"Nombre"),r(),t(7,"th",22),i(8,"Apellido"),r(),t(9,"th",22),i(10,"Rol actual"),r(),t(11,"th",22),i(12,"Asignar rol"),r(),t(13,"th",22),i(14,"Acci\xF3n"),r()()(),t(15,"tbody"),x(16,Z,22,15,"tr",23),r()()),o&2){let e=f();a(16),d("ngForOf",e.usuarios)}}function te(o,n){o&1&&(t(0,"div",36),p(),t(1,"svg",37),c(2,"path",6)(3,"path",7),r(),u(),t(4,"h3",38),i(5,"No hay usuarios registrados"),r(),t(6,"p",39),i(7,"Los usuarios aparecer\xE1n aqu\xED cuando se registren en el sistema."),r()())}var J=class o{constructor(n,e){this.usuariosService=n;this.rolesService=e}usuarios=[];roles=[];loading=!0;SUPERADMIN_ID="e3a3f8f6-ded6-45fa-a2e3-5d873e6fab34";ngOnInit(){return m(this,null,function*(){yield this.cargarRoles(),yield this.cargarUsuarios()})}cargarRoles(){return m(this,null,function*(){this.roles=yield this.rolesService.getRoles()})}cargarUsuarios(){return m(this,null,function*(){this.loading=!0;let n=yield this.usuariosService.getUsuarios();this.usuarios=n.map(e=>E(w({},e),{esSuperadmin:e.id_usuario===this.SUPERADMIN_ID})),this.loading=!1})}guardarRol(n){return m(this,null,function*(){if(n.esSuperadmin){alert("\u26A0\uFE0F El superadmin no puede cambiar de rol.");return}try{yield this.usuariosService.actualizarRolUsuario(n.id_usuario,n.id_rol??null),alert("Rol actualizado correctamente");let e=localStorage.getItem("user_id");e&&e===n.id_usuario&&console.warn("Has cambiado tu propio rol. Vuelve a iniciar sesi\xF3n para aplicar cambios.")}catch(e){console.error(e),alert("Error al actualizar rol")}})}static \u0275fac=function(e){return new(e||o)(_(q),_(y))};static \u0275cmp=R({type:o,selectors:[["app-usuarios"]],standalone:!0,features:[O],decls:27,vars:3,consts:[["sinDatos",""],[1,"w-full","max-w-[1200px]","mx-auto","flex","flex-col","px-2","md:px-3","pb-2"],[1,"flex","items-start","justify-between","gap-4","px-0","py-3","pb-2","bg-transparent","border-none","shadow-none"],[1,"flex-1"],[1,"flex","items-center","gap-3"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-blue-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 12a3 3 0 11-6 0 3 3 0 016 0z"],[1,"m-0","text-2xl","font-semibold","text-gray-900","tracking-wide"],[1,"mt-1","mb-0","text-sm","text-gray-600"],[1,"flex","items-center","justify-between","px-0","py-1.5","mb-1.5","border-b","border-gray-200"],[1,"flex","items-center","text-gray-900","text-xs","font-semibold","uppercase","gap-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-gray-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"],[1,"px-0","pb-2"],[1,"flex","items-center","gap-2","text-sm","text-gray-900","font-medium"],["type","search","placeholder","",1,"px-3","py-1.5","border","border-gray-300","rounded","text-sm","text-gray-900","bg-white","outline-none","transition-all","focus:border-blue-600","focus:ring-1","focus:ring-blue-600"],[1,"rounded-none","border-none","bg-transparent","overflow-auto","shadow-none","px-0","pb-2"],["class","p-6 text-center text-gray-500",4,"ngIf"],["class","w-full border-collapse min-w-[960px]",4,"ngIf","ngIfElse"],[1,"p-6","text-center","text-gray-500"],[1,"w-full","border-collapse","min-w-[960px]"],[1,"text-left","text-xs","tracking-wider","uppercase","text-gray-600","py-3.5","px-4","bg-transparent","sticky","top-0","border-b","border-gray-200","font-semibold"],["class","hover:bg-blue-50 transition-colors",4,"ngFor","ngForOf"],[1,"hover:bg-blue-50","transition-colors"],[1,"py-4","px-4","border-b","border-gray-100","align-middle","text-gray-900","text-sm","font-semibold"],[1,"py-4","px-4","border-b","border-gray-100","align-middle","text-gray-900","text-sm"],[1,"py-4","px-4","border-b","border-gray-100","align-middle"],[1,"px-2","py-1","rounded-full","text-xs","font-medium"],[1,"px-3","py-2","rounded-lg","border","border-gray-300","bg-gray-50","text-gray-900","outline-none","text-sm","transition-all","focus:border-blue-600","focus:bg-white","focus:ring-1","focus:ring-blue-200","hover:border-gray-400",3,"ngModelChange","ngModel"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"flex","gap-2.5","justify-end"],["title","Guardar rol",1,"border","border-gray-300","bg-white","text-gray-900","rounded-lg","px-3.5","py-2","cursor-pointer","inline-flex","items-center","gap-2","transition-all","hover:-translate-y-0.5","hover:bg-gray-50","hover:border-gray-400","hover:shadow","text-xs","font-medium","whitespace-nowrap",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-3.5","h-3.5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],[1,"py-12","px-6","text-center","text-gray-600"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-12","h-12","mx-auto","mb-4","text-blue-600"],[1,"m-0","mb-2","text-gray-900","font-semibold"],[1,"m-0","text-gray-600"]],template:function(e,l){if(e&1&&(t(0,"div",1)(1,"header",2)(2,"div",3)(3,"div",4),p(),t(4,"svg",5),c(5,"path",6)(6,"path",7),r(),u(),t(7,"div")(8,"h1",8),i(9,"Gesti\xF3n de Usuarios y Roles"),r(),t(10,"p",9),i(11,"Administra usuarios y asigna roles del sistema."),r()()()()(),t(12,"div",10)(13,"div",11),p(),t(14,"svg",12),c(15,"path",13),r(),u(),t(16,"span"),i(17,"REGISTROS"),r()()(),t(18,"div",14)(19,"label",15),i(20," Search: "),c(21,"input",16),r()(),t(22,"section",17),x(23,X,2,0,"div",18)(24,ee,17,1,"table",19)(25,te,8,0,"ng-template",null,0,j),r()()),e&2){let s=V(26);a(23),d("ngIf",l.loading),a(),d("ngIf",!l.loading&&l.usuarios.length)("ngIfElse",s)}},dependencies:[A,L,D,W,H,P,z,G,B],encapsulation:2})};export{J as UsuariosComponent};
