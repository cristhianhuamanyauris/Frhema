import{a as re}from"./chunk-NU4TNAVU.js";import{a as ie}from"./chunk-HTILIRKQ.js";import{a as te}from"./chunk-OWAPCZKH.js";import{a as ee}from"./chunk-5HNPAAR5.js";import{a as oe}from"./chunk-73ES3AEX.js";import{a as R,b as O,c as G,d as H,e as z,f as q,g as U,h as $,i as Q,j as J,k as K,l as X,m as Y,p as Z}from"./chunk-BIJEMQVT.js";import"./chunk-M2GT5SNT.js";import{$a as _,Db as N,Eb as F,Ga as S,Hb as B,Ia as p,Ka as I,La as A,Ma as t,Na as i,Oa as g,Pa as k,Qa as y,Ra as s,Va as L,W as T,Wa as n,Xa as M,Ya as w,ab as f,bb as v,ca as m,da as u,db as D,ea as x,fa as h,jb as W,qb as j,wa as d,xa as P}from"./chunk-SFQMZB6G.js";import{a as V,h as E}from"./chunk-FK42CRUA.js";function ce(l,r){if(l&1){let e=k();t(0,"div",41)(1,"button",42),y("click",function(){m(e);let o=s();return u(o.nuevoProducto())}),x(),t(2,"svg",28),g(3,"path",43),i(),h(),t(4,"span"),n(5,"NUEVO PRODUCTO"),i()()()}}function de(l,r){l&1&&(t(0,"div",44),n(1,"Cargando productos..."),i())}function le(l,r){l&1&&(t(0,"span",95),n(1," SUSP "),i())}function se(l,r){if(l&1&&(t(0,"div",96),n(1),i()),l&2){let e=s().$implicit;d(),M(e.descripcion)}}function me(l,r){l&1&&(t(0,"span",97),x(),t(1,"svg",98),g(2,"path",99),i()())}function ue(l,r){l&1&&(x(),t(0,"svg",100),g(1,"circle",101)(2,"path",102),i())}function pe(l,r){l&1&&(x(),t(0,"svg",103),g(1,"circle",101)(2,"path",104),i())}function ge(l,r){if(l&1){let e=k();t(0,"tr",57)(1,"td",58)(2,"div",59)(3,"span",60),n(4),i(),S(5,le,2,0,"span",61),i()(),t(6,"td",62)(7,"div",63)(8,"span",64),n(9),i(),S(10,se,2,1,"div",65),i()(),t(11,"td",66)(12,"span",67),n(13),i()(),t(14,"td",68)(15,"span",69),n(16),i()(),t(17,"td",68)(18,"span",70),n(19),i()(),t(20,"td",68)(21,"span",71),n(22),i()(),t(23,"td",68)(24,"span",72),n(25),i()(),t(26,"td",73)(27,"span",69),n(28),i()(),t(29,"td",73)(30,"span",74),n(31),i(),S(32,me,3,0,"span",75),i(),t(33,"td",73)(34,"div",76)(35,"div",77)(36,"span",78),n(37,"Unit:"),i(),t(38,"span",79),n(39),i()(),t(40,"div",77)(41,"span",78),n(42,"May:"),i(),t(43,"span",80),n(44),i()()()(),t(45,"td",73)(46,"div",76)(47,"div",77)(48,"span",78),n(49,"Norm:"),i(),t(50,"span",81),n(51),i()(),t(52,"div",77)(53,"span",78),n(54,"May:"),i(),t(55,"span",80),n(56),i()()()(),t(57,"td",82)(58,"div",83),S(59,ue,3,0,"svg",84)(60,pe,3,0,"svg",85),i()(),t(61,"td",82)(62,"div",86)(63,"button",87),y("click",function(){let o=m(e).$implicit,c=s(2);return u(c.editarProducto(o))}),x(),t(64,"svg",88),g(65,"path",89),i()(),h(),t(66,"button",90),y("click",function(){let o=m(e).$implicit,c=s(2);return u(c.abrirModalMovimientoStock(o))}),x(),t(67,"svg",88),g(68,"path",91),i()(),h(),t(69,"label",92)(70,"input",93),y("change",function(){let o=m(e).$implicit,c=s(2);return u(c.cambiarEstadoProducto(o))}),i(),g(71,"div",94),i()()()()}if(l&2){let e=r.$implicit,a=s(2);I("opacity-50",e.activo===!1)("bg-gray-100",e.activo===!1),d(4),M(e.codigo),d(),p("ngIf",e.activo===!1),d(4),M(e.nombre),d(),p("ngIf",e.descripcion),d(3),M(e.marca||"-"),d(3),M(e.unidad_medida),d(3),M(a.getIngresoComprado(e)||0),d(3),w("S/",a.getPrecioCompraPromedio(e).toFixed(2),""),d(3),w("S/",a.getTotalCompraHistorica(e).toFixed(2),""),d(3),M(e.unidad_medida),d(2),A((e.stock_actual||0)<=0?"text-red-600 font-bold text-sm":"text-blue-600 font-bold text-sm"),p("title",(e.stock_actual||0)<=0?"Stock en CERO o negativo":""),d(),w(" ",a.getStockActual(e)," "),d(),p("ngIf",(e.stock_actual||0)<=0),d(7),w("S/",(e.precio_unitario||0).toFixed(2),""),d(5),w("S/",(e.precio_mayor||0).toFixed(2),""),d(7),w("S/",a.getTotalVentaNormal(e).toFixed(2),""),d(5),w("S/",a.getTotalVentaMayor(e).toFixed(2),""),d(3),p("ngIf",e.activo===!1),d(),p("ngIf",e.activo!==!1),d(10),p("checked",e.activo!==!1)}}function xe(l,r){if(l&1&&(t(0,"table",45)(1,"thead")(2,"tr",46)(3,"th",47),n(4,"C\xF3digo"),i(),t(5,"th",48),n(6,"Descripci\xF3n"),i(),t(7,"th",48),n(8,"Marca"),i(),t(9,"th",49),n(10,"UND - COMPRA"),i(),t(11,"th",50),n(12,"TOTAL DE MATERIALES A VENDER"),i(),t(13,"th",51),n(14,"Estado"),i(),t(15,"th",51),n(16,"Acciones"),i()(),t(17,"tr",46),g(18,"th",47)(19,"th",47)(20,"th",47),t(21,"th",52),n(22,"Unidad"),i(),t(23,"th",52),n(24,"Cantidad"),i(),t(25,"th",52),n(26,"Precio"),i(),t(27,"th",52),n(28,"Total"),i(),t(29,"th",53),n(30,"Unidad"),i(),t(31,"th",53),n(32,"Cantidad"),i(),t(33,"th",53),n(34,"Precio"),i(),t(35,"th",53),n(36,"Total"),i(),g(37,"th",54)(38,"th",54),i()(),t(39,"tbody",55),S(40,ge,72,26,"tr",56),i()()),l&2){let e=s();d(40),p("ngForOf",e.productosFiltrados)}}function _e(l,r){if(l&1){let e=k();t(0,"button",110),y("click",function(){m(e);let o=s(2);return u(o.nuevoProducto())}),x(),t(1,"svg",33),g(2,"path",43),i(),h(),t(3,"span"),n(4,"Nuevo Producto"),i()()}}function fe(l,r){if(l&1&&(t(0,"div",105),x(),t(1,"svg",106),g(2,"path",8),i(),h(),t(3,"h3",107),n(4,"No hay productos registrados"),i(),t(5,"p",108),n(6,"Crea uno con el bot\xF3n "),t(7,"b"),n(8,"Nuevo Producto"),i(),n(9,"."),i(),S(10,_e,5,0,"button",109),i()),l&2){let e=s();d(10),p("ngIf",!e.modoEdicion)}}function ve(l,r){if(l&1){let e=k();t(0,"div",111),y("click",function(){m(e);let o=s();return u(o.cerrarModalMovimientoStock())}),t(1,"div",112),y("click",function(o){return m(e),u(o.stopPropagation())}),t(2,"div",113)(3,"h3",114)(4,"span",115),x(),t(5,"svg",116),g(6,"path",117),i()(),n(7," Registrar Movimiento de Stock "),i(),h(),t(8,"button",118),y("click",function(){m(e);let o=s();return u(o.cerrarModalMovimientoStock())}),x(),t(9,"svg",119),g(10,"path",120),i()()(),h(),t(11,"div",121)(12,"div",122)(13,"div",123)(14,"div")(15,"label",124),n(16,"Producto"),i(),t(17,"p",125),n(18),i()(),t(19,"div")(20,"label",124),n(21,"Stock Actual"),i(),t(22,"p",126),n(23),i()()()(),t(24,"div")(25,"label",127),n(26," Tipo de Movimiento "),t(27,"span",128),n(28,"*"),i()(),t(29,"select",129),v("ngModelChange",function(o){m(e);let c=s();return f(c.tipoMovimiento,o)||(c.tipoMovimiento=o),u(o)}),t(30,"option",130),n(31,"\u2795 Entrada (Aumenta stock)"),i(),t(32,"option",131),n(33,"\u2796 Salida (Disminuye stock)"),i(),t(34,"option",132),n(35,"\u2699\uFE0F Ajuste (Establece stock exacto)"),i()()(),t(36,"div")(37,"label",127),n(38," Cantidad "),t(39,"span",128),n(40,"*"),i()(),t(41,"input",133),v("ngModelChange",function(o){m(e);let c=s();return f(c.cantidadMovimiento,o)||(c.cantidadMovimiento=o),u(o)}),i(),t(42,"div",134)(43,"p",135)(44,"span",60),n(45,"Stock resultante:"),i()(),t(46,"p",136),n(47),i()()(),t(48,"div")(49,"label",127),n(50," Motivo "),t(51,"span",137),n(52,"(Opcional)"),i()(),t(53,"input",138),v("ngModelChange",function(o){m(e);let c=s();return f(c.motivoMovimiento,o)||(c.motivoMovimiento=o),u(o)}),i()(),t(54,"div")(55,"label",127),n(56," Referencia "),t(57,"span",137),n(58,"(Opcional)"),i()(),t(59,"input",139),v("ngModelChange",function(o){m(e);let c=s();return f(c.referenciaMovimiento,o)||(c.referenciaMovimiento=o),u(o)}),i()()(),t(60,"div",140)(61,"button",141),y("click",function(){m(e);let o=s();return u(o.cerrarModalMovimientoStock())}),n(62," Cancelar "),i(),t(63,"button",142),y("click",function(){m(e);let o=s();return u(o.guardarMovimientoStock())}),x(),t(64,"svg",28),g(65,"path",143),i(),n(66," Registrar Movimiento "),i()()()()}if(l&2){let e=s();d(18),M(e.productoMovimientoStock.nombre),d(5),w("",e.productoMovimientoStock.stock_actual||0," unidades"),d(6),_("ngModel",e.tipoMovimiento),d(12),_("ngModel",e.cantidadMovimiento),d(6),w(" ",e.calcularNuevoStockMovimiento()," unidades "),d(6),_("ngModel",e.motivoMovimiento),d(6),_("ngModel",e.referenciaMovimiento)}}function he(l,r){if(l&1&&(t(0,"option",191),n(1),i()),l&2){let e=r.$implicit;p("value",e),d(),M(e)}}function be(l,r){if(l&1&&(t(0,"option",161),n(1),i()),l&2){let e=r.$implicit;p("ngValue",e.id_categoria),d(),M(e.nombre)}}function ye(l,r){if(l&1&&(t(0,"option",161),n(1),i()),l&2){let e=r.$implicit;p("ngValue",e.id_proveedor),d(),M(e.nombre)}}function Se(l,r){l&1&&(t(0,"p",192),x(),t(1,"svg",33),g(2,"path",99),i(),h(),t(3,"span"),n(4,"El stock est\xE1 en CERO. No se podr\xE1n realizar ventas hasta que se reponga stock."),i()())}function we(l,r){if(l&1){let e=k();t(0,"div")(1,"label",127),n(2,"Fecha de Vencimiento"),i(),t(3,"input",193),v("ngModelChange",function(o){m(e);let c=s(2);return f(c.producto.fecha_vencimiento,o)||(c.producto.fecha_vencimiento=o),u(o)}),i()()}if(l&2){let e=s(2);d(3),_("ngModel",e.producto.fecha_vencimiento)}}function Me(l,r){if(l&1){let e=k();t(0,"div")(1,"label",127),n(2,"Meses de Garant\xEDa"),i(),t(3,"input",194),v("ngModelChange",function(o){m(e);let c=s(2);return f(c.producto.meses_garantia,o)||(c.producto.meses_garantia=o),u(o)}),i()()}if(l&2){let e=s(2);d(3),_("ngModel",e.producto.meses_garantia)}}function Ce(l,r){if(l&1){let e=k();t(0,"div",144),y("click",function(){m(e);let o=s();return o.mostrarFormulario=!1,o.modoEdicion=!1,u(o.producto=o.getEmptyProducto())}),t(1,"div",145),y("click",function(o){return m(e),u(o.stopPropagation())}),t(2,"div",146)(3,"div",147)(4,"h3",148),x(),t(5,"svg",13),g(6,"path",8),i(),n(7),i(),h(),t(8,"button",149),y("click",function(){m(e);let o=s();return o.mostrarFormulario=!1,o.modoEdicion=!1,u(o.producto=o.getEmptyProducto())}),x(),t(9,"svg",119),g(10,"path",120),i()()(),h(),t(11,"form",150),y("ngSubmit",function(){m(e);let o=s();return u(o.guardarProducto())}),t(12,"div",31)(13,"h4",151),x(),t(14,"svg",152),g(15,"path",153),i(),n(16," Informaci\xF3n B\xE1sica "),i(),h(),t(17,"div",154)(18,"div")(19,"label",127),n(20," Nombre del Producto "),t(21,"span",128),n(22,"*"),i()(),t(23,"input",155),v("ngModelChange",function(o){m(e);let c=s();return f(c.producto.nombre,o)||(c.producto.nombre=o),u(o)}),i()()(),t(24,"div",156)(25,"div")(26,"label",127),n(27," C\xF3digo (Auto-generado) "),i(),t(28,"input",157),v("ngModelChange",function(o){m(e);let c=s();return f(c.producto.codigo,o)||(c.producto.codigo=o),u(o)}),i()(),t(29,"div")(30,"label",127),n(31," Und. Medida "),t(32,"span",128),n(33,"*"),i()(),t(34,"select",158),v("ngModelChange",function(o){m(e);let c=s();return f(c.producto.unidad_medida,o)||(c.producto.unidad_medida=o),u(o)}),S(35,he,2,2,"option",159),i()(),t(36,"div")(37,"label",127),n(38," Categor\xEDa "),t(39,"span",128),n(40,"*"),i()(),t(41,"select",160),v("ngModelChange",function(o){m(e);let c=s();return f(c.producto.id_categoria,o)||(c.producto.id_categoria=o),u(o)}),t(42,"option",161),n(43,"Seleccione una categor\xEDa..."),i(),S(44,be,2,2,"option",162),i()(),t(45,"div")(46,"label",127),n(47," Marca "),i(),t(48,"input",163),v("ngModelChange",function(o){m(e);let c=s();return f(c.producto.marca,o)||(c.producto.marca=o),u(o)}),i()(),t(49,"div")(50,"label",127),n(51,"Proveedor"),i(),t(52,"select",164),v("ngModelChange",function(o){m(e);let c=s();return f(c.producto.id_proveedor,o)||(c.producto.id_proveedor=o),u(o)}),t(53,"option",161),n(54,"-- Seleccione --"),i(),S(55,ye,2,2,"option",162),i()()()(),t(56,"div",31)(57,"h4",151),x(),t(58,"svg",152),g(59,"path",165),i(),n(60," Precios y Stock "),i(),h(),t(61,"div",166)(62,"div")(63,"label",127),n(64," Precio de Compra "),i(),t(65,"div",167)(66,"span",168),n(67,"S/"),i(),t(68,"input",169),v("ngModelChange",function(o){m(e);let c=s();return f(c.producto.precio_compra,o)||(c.producto.precio_compra=o),u(o)}),i()()(),t(69,"div")(70,"label",127),n(71," Precio de Venta "),t(72,"span",128),n(73,"*"),i()(),t(74,"div",167)(75,"span",168),n(76,"S/"),i(),t(77,"input",170),v("ngModelChange",function(o){m(e);let c=s();return f(c.producto.precio_unitario,o)||(c.producto.precio_unitario=o),u(o)}),i()()(),t(78,"div")(79,"label",127),n(80," Precio Venta x Mayor "),t(81,"span",128),n(82,"*"),i()(),t(83,"div",167)(84,"span",168),n(85,"S/"),i(),t(86,"input",171),v("ngModelChange",function(o){m(e);let c=s();return f(c.producto.precio_mayor,o)||(c.producto.precio_mayor=o),u(o)}),i()()(),t(87,"div")(88,"label",127),n(89," Stock Inicial "),t(90,"span",128),n(91,"*"),i()(),t(92,"input",172),v("ngModelChange",function(o){m(e);let c=s();return f(c.producto.stock_actual,o)||(c.producto.stock_actual=o),u(o)}),y("blur",function(){m(e);let o=s();return u(o.validarStock())})("input",function(){m(e);let o=s();return u(o.validarStock())}),i(),S(93,Se,5,0,"p",173),i()(),t(94,"div",174)(95,"div",175)(96,"label",127),n(97,"Descripci\xF3n"),i(),t(98,"textarea",176),v("ngModelChange",function(o){m(e);let c=s();return f(c.producto.descripcion,o)||(c.producto.descripcion=o),u(o)}),i()()()(),t(99,"div",31)(100,"h4",151),x(),t(101,"svg",152),g(102,"path",177),i(),n(103," Informaci\xF3n Adicional (Ferreter\xEDa) "),i(),h(),t(104,"div",174)(105,"div")(106,"label",127),n(107," Material "),i(),t(108,"input",178),v("ngModelChange",function(o){m(e);let c=s();return f(c.producto.material,o)||(c.producto.material=o),u(o)}),i()(),t(109,"div")(110,"label",127),n(111," Peso (kg) "),i(),t(112,"input",179),v("ngModelChange",function(o){m(e);let c=s();return f(c.producto.peso,o)||(c.producto.peso=o),u(o)}),i()(),t(113,"div")(114,"label",127),n(115," Medidas (LxAxA) "),i(),t(116,"input",180),v("ngModelChange",function(o){m(e);let c=s();return f(c.producto.medidas,o)||(c.producto.medidas=o),u(o)}),i()()()(),t(117,"div",31)(118,"h4",151),x(),t(119,"svg",152),g(120,"path",181),i(),n(121," Caducidad y Garant\xEDa "),i(),h(),t(122,"div",182)(123,"div",183)(124,"input",184),v("ngModelChange",function(o){m(e);let c=s();return f(c.producto.tiene_caducidad,o)||(c.producto.tiene_caducidad=o),u(o)}),i(),t(125,"label",185),n(126," \xBFTiene caducidad? "),i()(),t(127,"div",183)(128,"input",186),v("ngModelChange",function(o){m(e);let c=s();return f(c.producto.tiene_garantia,o)||(c.producto.tiene_garantia=o),u(o)}),i(),t(129,"label",185),n(130," \xBFTiene garant\xEDa? "),i()(),S(131,we,4,1,"div",187)(132,Me,4,1,"div",187),i()(),t(133,"div",188)(134,"button",189),y("click",function(){m(e);let o=s();return o.mostrarFormulario=!1,o.modoEdicion=!1,u(o.producto=o.getEmptyProducto())}),n(135," Cancelar "),i(),t(136,"button",190),x(),t(137,"svg",28),g(138,"path",143),i(),n(139),i()()()()()()}if(l&2){let e=s();d(7),w(" ",e.modoEdicion?"Editar Producto":"Crear Nuevo Producto"," "),d(16),_("ngModel",e.producto.nombre),d(5),_("ngModel",e.producto.codigo),p("value",e.producto.codigo),d(6),_("ngModel",e.producto.unidad_medida),d(),p("ngForOf",e.unidadesMedida),d(6),_("ngModel",e.producto.id_categoria),d(),p("ngValue",null),d(2),p("ngForOf",e.categorias),d(4),_("ngModel",e.producto.marca),d(4),_("ngModel",e.producto.id_proveedor),d(),p("ngValue",null),d(2),p("ngForOf",e.proveedores),d(13),_("ngModel",e.producto.precio_compra),d(9),_("ngModel",e.producto.precio_unitario),d(9),_("ngModel",e.producto.precio_mayor),d(6),_("ngModel",e.producto.stock_actual),d(),p("ngIf",(e.producto.stock_actual||0)===0),d(5),_("ngModel",e.producto.descripcion),d(10),_("ngModel",e.producto.material),d(4),_("ngModel",e.producto.peso),d(4),_("ngModel",e.producto.medidas),d(8),_("ngModel",e.producto.tiene_caducidad),d(4),_("ngModel",e.producto.tiene_garantia),d(3),p("ngIf",e.producto.tiene_caducidad),d(),p("ngIf",e.producto.tiene_garantia),d(7),w(" ",e.modoEdicion?"Guardar Cambios":"Guardar Producto"," ")}}var ne=class l{constructor(r,e,a,o,c,b){this.productosService=r;this.categoriasService=e;this.proveedoresService=a;this.comprasService=o;this.notificacionesService=c;this.cdr=b}productos=[];productosFiltrados=[];categorias=[];proveedores=[];loading=!0;terminoBusqueda="";mostrarFormulario=!1;modoEdicion=!1;mostrarModalMovimientoStock=!1;productoMovimientoStock=null;tipoMovimiento="ENTRADA";cantidadMovimiento=0;motivoMovimiento="";referenciaMovimiento="";producto=this.getEmptyProducto();unidadesMedida=["UND","M","KG","CAJA","L","M2","M3","PAR","SET","ROLLO","BOLSA","LITRO","GALON"];resumenCompras=new Map;ngOnInit(){return E(this,null,function*(){yield this.cargarCategorias(),yield this.cargarProveedores(),yield this.cargarProductos()})}getEmptyProducto(){return{codigo:"",nombre:"",descripcion:"",id_categoria:null,id_proveedor:null,unidad_medida:"UND",stock_actual:0,stock_minimo:0,precio_unitario:0,precio_mayor:null,tiene_caducidad:!1,fecha_vencimiento:null,tiene_garantia:!1,meses_garantia:null,precio_compra:null,marca:null,material:null,peso:null,medidas:null,activo:!0}}cargarCategorias(){return E(this,null,function*(){this.categorias=yield this.categoriasService.getCategorias()})}cargarProveedores(){return E(this,null,function*(){this.proveedores=yield this.proveedoresService.getProveedores()})}cargarProductos(){return E(this,null,function*(){this.loading=!0;try{this.productos=yield this.productosService.getProductos(!0);let r=[];for(let e of this.productos){e.stock_actual<0&&(console.warn(`Producto ${e.nombre} tiene stock negativo (${e.stock_actual}). Corrigiendo a 0.`),e.stock_actual=0);let a=e.stock_actual||0;if((e.activo===null||e.activo===void 0)&&(e.activo=a>0,console.log(`Producto "${e.nombre}": campo 'activo' no existe, establecido a ${e.activo} basado en stock ${a}`)),a===0&&e.activo===!0&&e.id_producto){console.log(`[SUSPENSI\xD3N AUTOM\xC1TICA] Producto "${e.nombre}" tiene stock ${a} y est\xE1 activo. Suspendi\xE9ndolo...`);try{yield this.productosService.updateProducto(e.id_producto,{activo:!1}),e.activo=!1,console.log(`\u2705 Producto "${e.nombre}" suspendido autom\xE1ticamente por stock cero`)}catch(o){o?.message&&(o.message.includes("column")||o.message.includes("activo")||o.message.includes("does not exist"))?(console.warn("\u26A0\uFE0F Campo 'activo' no existe en Supabase. Actualizando solo localmente. Ejecuta el SQL para agregar el campo."),e.activo=!1):console.error(`\u274C Error al suspender producto ${e.id_producto}:`,o)}}if(a>0&&e.activo===!1&&e.id_producto){console.log(`[REACTIVACI\xD3N AUTOM\xC1TICA] Producto "${e.nombre}" tiene stock ${a} y est\xE1 suspendido. Reactiv\xE1ndolo...`);try{yield this.productosService.updateProducto(e.id_producto,{activo:!0}),e.activo=!0,console.log(`\u2705 Producto "${e.nombre}" reactivado autom\xE1ticamente por tener stock`)}catch(o){o?.message&&(o.message.includes("column")||o.message.includes("activo")||o.message.includes("does not exist"))?(console.warn("\u26A0\uFE0F Campo 'activo' no existe en Supabase. Actualizando solo localmente. Ejecuta el SQL para agregar el campo."),e.activo=!0):console.error(`\u274C Error al reactivar producto ${e.id_producto}:`,o)}}if(e.stock_actual===0&&r.push(e.nombre),e.id_producto)try{let o=yield this.comprasService.getResumenComprasPorProducto(e.id_producto);this.resumenCompras.set(e.id_producto,o)}catch(o){console.error(`Error al cargar resumen de compras para producto ${e.id_producto}:`,o),this.resumenCompras.set(e.id_producto,{cantidad_total:0,precio_unitario_promedio:e.precio_compra||0,precio_total_compra:0})}}r.length>0&&r.forEach((e,a)=>{let o=this.productos.find(c=>c.nombre===e);o&&this.notificacionesService.agregarNotificacion({id:`stock-cero-cargar-${o.id_producto||a}`,tipo:"stock_agotado",titulo:"Producto con Stock CERO",mensaje:`El producto "${e}" tiene stock en CERO. No se podr\xE1n realizar ventas hasta que se reponga stock.`,producto:o,fecha:new Date,leida:!1})})}catch(r){console.error("Error al cargar productos:",r)}finally{this.filtrarProductos(),this.loading=!1}})}filtrarProductos(){if(!this.terminoBusqueda.trim())this.productosFiltrados=this.productos;else{let r=this.terminoBusqueda.toLowerCase();this.productosFiltrados=this.productos.filter(e=>e.codigo?.toLowerCase().includes(r)||e.nombre?.toLowerCase().includes(r)||e.descripcion?.toLowerCase().includes(r))}}generarCodigo(){let r="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",e="";for(let a=0;a<10;a++)e+=r.charAt(Math.floor(Math.random()*r.length));return e}nuevoProducto(){this.modoEdicion=!1,this.mostrarFormulario=!this.mostrarFormulario,this.producto=this.getEmptyProducto(),this.modoEdicion||(this.producto.codigo=this.generarCodigo())}editarProducto(r){this.mostrarModalMovimientoStock=!1,this.productoMovimientoStock=null,this.modoEdicion=!0,this.mostrarFormulario=!0,this.producto=V({},r),this.producto.stock_actual<0&&(this.producto.stock_actual=0)}abrirModalMovimientoStock(r){console.log("Abriendo modal movimiento stock para:",r.nombre),this.mostrarFormulario=!1,this.modoEdicion=!1,this.productoMovimientoStock=V({},r),this.tipoMovimiento="ENTRADA",this.cantidadMovimiento=0,this.motivoMovimiento="",this.referenciaMovimiento="",this.mostrarModalMovimientoStock=!0,this.cdr.detectChanges(),console.log("Modal movimiento stock:",{mostrar:this.mostrarModalMovimientoStock,producto:this.productoMovimientoStock?.nombre,tieneProducto:!!this.productoMovimientoStock})}cerrarModalMovimientoStock(){this.mostrarModalMovimientoStock=!1,this.productoMovimientoStock=null,this.tipoMovimiento="ENTRADA",this.cantidadMovimiento=0,this.motivoMovimiento="",this.referenciaMovimiento=""}calcularNuevoStockMovimiento(){if(!this.productoMovimientoStock)return 0;let r=this.productoMovimientoStock.stock_actual||0,e=this.cantidadMovimiento||0;return this.tipoMovimiento==="ENTRADA"?r+e:this.tipoMovimiento==="SALIDA"?Math.max(0,r-e):e}guardarMovimientoStock(){return E(this,null,function*(){if(!(!this.productoMovimientoStock||!this.productoMovimientoStock.id_producto)){if(this.cantidadMovimiento<=0){alert("La cantidad debe ser mayor a 0");return}try{let r=this.productoMovimientoStock.stock_actual||0,e=r,a=this.cantidadMovimiento;this.tipoMovimiento==="ENTRADA"?e=r+a:this.tipoMovimiento==="SALIDA"?(e=Math.max(0,r-a),a=-a):(e=a,a=a-r),e=Math.max(0,e),yield this.productosService.updateProducto(this.productoMovimientoStock.id_producto,{stock_actual:e});let{data:o,error:c}=yield this.productosService.registrarMovimientoStock({id_producto:this.productoMovimientoStock.id_producto,tipo:this.tipoMovimiento,cantidad:Math.abs(a),stock_antes:r,stock_despues:e,referencia:this.referenciaMovimiento||(this.motivoMovimiento?`Ajuste: ${this.motivoMovimiento}`:"Movimiento manual")});c&&console.error("Error al registrar movimiento:",c);let b=this.productos.find(C=>C.id_producto===this.productoMovimientoStock.id_producto);if(b&&b.id_producto){if(b.stock_actual=e,e===0&&b.activo!==!1)try{b.id_producto&&(yield this.productosService.updateProducto(b.id_producto,{activo:!1}),b.activo=!1)}catch(C){C?.message&&(C.message.includes("column")||C.message.includes("activo"))&&(b.activo=!1)}else if(e>0&&b.activo===!1)try{b.id_producto&&(yield this.productosService.updateProducto(b.id_producto,{activo:!0}),b.activo=!0)}catch(C){C?.message&&(C.message.includes("column")||C.message.includes("activo"))&&(b.activo=!0)}}let ae=this.tipoMovimiento==="ENTRADA"?"entrada":this.tipoMovimiento==="SALIDA"?"salida":"ajuste";this.notificacionesService.agregarNotificacion({id:`movimiento-stock-${this.productoMovimientoStock.id_producto}-${Date.now()}`,tipo:"info",titulo:"Movimiento de Stock Registrado",mensaje:`Se registr\xF3 una ${ae} de ${this.cantidadMovimiento} unidades para "${this.productoMovimientoStock.nombre}". Stock: ${r} \u2192 ${e}`,producto:this.productoMovimientoStock,fecha:new Date,leida:!1}),this.cerrarModalMovimientoStock(),this.filtrarProductos()}catch(r){console.error(r),alert("Error al registrar movimiento de stock: "+(r instanceof Error?r.message:"Error desconocido"))}}})}validarStock(){this.producto.stock_actual<0&&(this.producto.stock_actual=0,this.notificacionesService.agregarNotificacion({id:`stock-negativo-${Date.now()}`,tipo:"error",titulo:"Stock Negativo Corregido",mensaje:`El stock de "${this.producto.nombre||"producto"}" no puede ser negativo. Se ha ajustado a 0.`,producto:this.producto,fecha:new Date,leida:!1})),this.producto.stock_actual===0&&this.producto.nombre&&this.notificacionesService.agregarNotificacion({id:`stock-cero-${this.producto.id_producto||Date.now()}`,tipo:"stock_agotado",titulo:"Stock en CERO",mensaje:`El producto "${this.producto.nombre}" tiene stock en CERO. No se podr\xE1n realizar ventas hasta que se reponga stock.`,producto:this.producto,fecha:new Date,leida:!1})}prepararDatosParaSupabase(r){let e=Math.max(0,r.stock_actual||0),a=e>0,o={codigo:r.codigo,nombre:r.nombre,descripcion:r.descripcion||null,id_categoria:r.id_categoria,id_proveedor:r.id_proveedor,unidad_medida:r.unidad_medida,stock_actual:e,stock_minimo:0,precio_unitario:r.precio_unitario,precio_mayor:r.precio_mayor||null,tiene_caducidad:r.tiene_caducidad,fecha_vencimiento:r.fecha_vencimiento||null,tiene_garantia:r.tiene_garantia,meses_garantia:r.meses_garantia||null,activo:a};return r.precio_compra!==null&&r.precio_compra!==void 0?o.precio_compra=r.precio_compra:o.precio_compra=null,r.marca&&(o.marca=r.marca),o}guardarProducto(){return E(this,null,function*(){try{if(this.producto.stock_actual<0&&(this.producto.stock_actual=0,this.notificacionesService.agregarNotificacion({id:`stock-negativo-guardar-${Date.now()}`,tipo:"error",titulo:"Stock Negativo Corregido",mensaje:`El stock de "${this.producto.nombre||"producto"}" no puede ser negativo. Se ha ajustado a 0.`,producto:this.producto,fecha:new Date,leida:!1})),this.producto.stock_actual===0)this.notificacionesService.agregarNotificacion({id:`stock-cero-guardar-${this.producto.id_producto||Date.now()}`,tipo:"stock_agotado",titulo:"Producto Suspendido Autom\xE1ticamente",mensaje:`El producto "${this.producto.nombre}" ha sido suspendido autom\xE1ticamente por tener stock en CERO. Se reactivar\xE1 cuando se actualice el stock.`,producto:this.producto,fecha:new Date,leida:!1});else if(this.producto.stock_actual>0&&this.producto.id_producto){let e=this.productos.find(a=>a.id_producto===this.producto.id_producto);e&&e.activo===!1&&this.notificacionesService.agregarNotificacion({id:`producto-reactivado-${this.producto.id_producto}`,tipo:"info",titulo:"Producto Reactivado",mensaje:`El producto "${this.producto.nombre}" ha sido reactivado autom\xE1ticamente al actualizar el stock.`,producto:this.producto,fecha:new Date,leida:!1})}!this.modoEdicion&&(!this.producto.codigo||this.producto.codigo.trim()==="")&&(this.producto.codigo=this.generarCodigo());let r=this.prepararDatosParaSupabase(this.producto);try{this.modoEdicion&&this.producto.id_producto?(yield this.productosService.updateProducto(this.producto.id_producto,r),this.notificacionesService.agregarNotificacion({id:`producto-actualizado-${Date.now()}`,tipo:"info",titulo:"Producto Actualizado",mensaje:`El producto "${this.producto.nombre}" ha sido actualizado correctamente.`,producto:this.producto,fecha:new Date,leida:!1})):(yield this.productosService.addProducto(r),this.notificacionesService.agregarNotificacion({id:`producto-creado-${Date.now()}`,tipo:"info",titulo:"Producto Creado",mensaje:`El producto "${this.producto.nombre}" ha sido creado correctamente.`,producto:this.producto,fecha:new Date,leida:!1}))}catch(e){if(e?.message&&(e.message.includes("column")||e.message.includes("activo")||e.message.includes("does not exist"))){console.warn('Campo "activo" no existe en Supabase. Guardando sin ese campo...');let a=V({},r);delete a.activo,this.modoEdicion&&this.producto.id_producto?(yield this.productosService.updateProducto(this.producto.id_producto,a),this.notificacionesService.agregarNotificacion({id:`producto-actualizado-sin-activo-${Date.now()}`,tipo:"warning",titulo:"Producto Actualizado (sin campo activo)",mensaje:`El producto "${this.producto.nombre}" se guard\xF3 correctamente, pero el campo 'activo' no existe en Supabase. Ejecuta el SQL para agregarlo.`,producto:this.producto,fecha:new Date,leida:!1})):(yield this.productosService.addProducto(a),this.notificacionesService.agregarNotificacion({id:`producto-creado-sin-activo-${Date.now()}`,tipo:"warning",titulo:"Producto Creado (sin campo activo)",mensaje:`El producto "${this.producto.nombre}" se cre\xF3 correctamente, pero el campo 'activo' no existe en Supabase. Ejecuta el SQL para agregarlo.`,producto:this.producto,fecha:new Date,leida:!1}))}else throw e}this.producto=this.getEmptyProducto(),this.modoEdicion=!1,this.mostrarFormulario=!1,this.cargarProductos()}catch(r){console.error(r),alert("Error al guardar: "+(r instanceof Error?r.message:"Error desconocido"))}})}cambiarEstadoProducto(r){return E(this,null,function*(){if(!r.id_producto)return;let e=!r.activo,a=e?"activar":"suspender";try{yield this.productosService.updateProducto(r.id_producto,{activo:e}),r.activo=e,this.notificacionesService.agregarNotificacion({id:`producto-${a}-${r.id_producto}-${Date.now()}`,tipo:e?"info":"warning",titulo:e?"Producto Activado":"Producto Suspendido",mensaje:`El producto "${r.nombre}" ha sido ${e?"activado":"suspendido"} ${e?"y ahora est\xE1 disponible para ventas":"y no aparecer\xE1 en el POS"}.`,producto:r,fecha:new Date,leida:!1})}catch(o){console.error(o),o?.message&&(o.message.includes("column")||o.message.includes("activo")||o.message.includes("does not exist"))?(r.activo=e,this.notificacionesService.agregarNotificacion({id:`producto-${a}-local-${r.id_producto}-${Date.now()}`,tipo:"warning",titulo:'Campo "activo" no existe en Supabase',mensaje:"El campo 'activo' no existe en la base de datos. El estado se actualiz\xF3 solo localmente. Por favor, ejecuta el SQL para agregar el campo 'activo' a la tabla 'productos'.",producto:r,fecha:new Date,leida:!1})):(r.activo=!e,alert(`Error al ${a} el producto: ${o instanceof Error?o.message:"Error desconocido"}`))}})}getCategoriaNombre(r){return this.categorias.find(e=>e.id_categoria===r)?.nombre||"-"}getProveedorNombre(r){return this.proveedores.find(e=>e.id_proveedor===r)?.nombre||"-"}getStockActual(r){return Math.max(0,r.stock_actual||0)}getTotalStock(){return this.productos.reduce((r,e)=>r+Math.max(0,e.stock_actual||0),0)}getCapitalInvertido(){return this.productos.reduce((r,e)=>{let a=Math.max(0,e.precio_compra||0),o=Math.max(0,e.stock_actual||0);return r+a*o},0)}getValorVenta(){return this.productos.reduce((r,e)=>{let a=Math.max(0,e.precio_unitario||0),o=Math.max(0,e.stock_actual||0);return r+a*o},0)}getValorTotalProducto(r){return(r.precio_unitario||0)*(r.stock_actual||0)}getResumenCompras(r){return r?this.resumenCompras.get(r)||{cantidad_total:0,precio_unitario_promedio:0,precio_total_compra:0}:{cantidad_total:0,precio_unitario_promedio:0,precio_total_compra:0}}getIngresoComprado(r){let e=this.getResumenCompras(r.id_producto);return e.cantidad_total>0?Math.max(0,e.cantidad_total):Math.max(0,r.stock_actual||0)}getPrecioCompraPromedio(r){let e=this.getResumenCompras(r.id_producto);return e.precio_unitario_promedio>0?Math.max(0,e.precio_unitario_promedio):Math.max(0,r.precio_compra||0)}getTotalCompraHistorica(r){let e=this.getResumenCompras(r.id_producto);if(e.precio_total_compra>0)return Math.max(0,e.precio_total_compra);let a=this.getIngresoComprado(r),o=this.getPrecioCompraPromedio(r);return Math.max(0,a*o)}getTotalVentaNormal(r){let e=Math.max(0,r.precio_unitario||0),a=Math.max(0,r.stock_actual||0);return e*a}getTotalVentaMayor(r){let e=Math.max(0,r.precio_mayor||0),a=Math.max(0,r.stock_actual||0);return e*a}getCostoStockActual(r){let e=this.getPrecioCompraPromedio(r),a=Math.max(0,r.stock_actual||0);return Math.max(0,e*a)}getMargenPotencialNormal(r){let e=this.getTotalVentaNormal(r),a=this.getCostoStockActual(r);return e-a}getMargenPotencialMayor(r){let e=this.getTotalVentaMayor(r),a=this.getCostoStockActual(r);return e-a}static \u0275fac=function(e){return new(e||l)(P(ee),P(oe),P(ie),P(re),P(te),P(j))};static \u0275cmp=T({type:l,selectors:[["app-productos"]],standalone:!0,features:[D],decls:66,vars:11,consts:[["sinDatos",""],[1,"h-full","overflow-y-auto"],[1,"container","px-3","mx-auto","grid"],[1,"px-6","py-2","border-b","border-gray-200"],[1,"flex","flex-col","md:flex-row","md:items-center","md:justify-between"],[1,"text-xl","md:text-2xl","font-bold","text-gray-800"],[1,"inline-flex","items-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","mr-3","text-blue-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"],[1,"mt-1","text-xs","md:text-sm","text-gray-500"],[1,"mb-4","mt-3"],["id","detalles-productos-container",1,"bg-white","p-4","rounded-lg","shadow-md"],[1,"text-lg","font-bold","text-gray-800","mb-3"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","inline","mr-2","text-blue-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-2","text-xs","md:text-sm"],[1,"p-3","bg-gray-50","rounded-lg","text-center","shadow"],[1,"text-gray-500","block"],["id","total-productos",1,"text-sm","md:text-base","font-bold","text-blue-600"],["id","total-stock",1,"text-sm","md:text-base","font-bold","text-blue-600"],[1,"text-sm","md:text-base","font-bold","text-yellow-600"],[1,"text-xs","mr-1"],[1,"text-sm","md:text-base","font-bold","text-green-600"],[1,"w-full","overflow-hidden","rounded-lg","shadow-xs","mt-3"],[1,"w-full","overflow-x-auto"],[1,"bg-white","rounded-lg","shadow-md","p-2","md:p-4","mb-6"],[1,"flex","items-center","justify-between","py-2","mb-2","border-b","border-gray-200"],[1,"flex","items-center","text-gray-700","text-xs","font-semibold","ml-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"],["class","flex items-center space-x-2",4,"ngIf"],[1,"mb-4"],[1,"flex","items-center","gap-2","text-sm","text-gray-700","font-medium"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],["type","search","placeholder","Buscar por c\xF3digo, nombre o descripci\xF3n...",1,"flex-1","px-3","py-1.5","border","border-gray-300","rounded-lg","text-sm","text-gray-900","bg-white","outline-none","transition-all","focus:border-blue-500","focus:ring-2","focus:ring-blue-200",3,"ngModelChange","ngModel"],[1,"w-full","overflow-x-auto","pb-2"],["class","p-6 text-center text-gray-500",4,"ngIf"],["class","w-full whitespace-no-wrap",4,"ngIf","ngIfElse"],["class","fixed inset-0 z-[2000] bg-black/50 backdrop-blur-sm flex items-center justify-center p-4",3,"click",4,"ngIf"],["class","fixed inset-0 z-50 flex items-center justify-center w-full h-full bg-black bg-opacity-50 overflow-y-auto overflow-x-hidden",3,"click",4,"ngIf"],[1,"flex","items-center","space-x-2"],["type","button",1,"flex","items-center","justify-center","p-2","text-xs","bg-blue-600","hover:bg-blue-700","text-white","rounded-lg","shadow-lg","transition-all","duration-200","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:ring-offset-2",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],[1,"p-6","text-center","text-gray-500"],[1,"w-full","whitespace-no-wrap"],[1,"text-xs","font-semibold","tracking-wide","text-left","text-gray-500","uppercase","border-b","border-gray-200","bg-gray-50"],[1,"px-4","py-3"],[1,"px-4","py-3","text-center"],["colspan","4",1,"px-3","py-3","text-center","bg-blue-100"],["colspan","4",1,"px-3","py-3","text-center","bg-orange-100"],[1,"px-3","py-3","text-center"],[1,"px-2","py-2","text-center","bg-blue-50","text-[10px]"],[1,"px-2","py-2","text-center","bg-orange-50","text-[10px]"],[1,"px-3","py-3"],[1,"bg-white","divide-y","divide-gray-200"],["class","hover:bg-gray-100 transition-colors",3,"opacity-50","bg-gray-100",4,"ngFor","ngForOf"],[1,"hover:bg-gray-100","transition-colors"],[1,"px-3","py-2","text-xs","text-gray-700"],[1,"flex","items-center","gap-1.5"],[1,"font-medium"],["class","inline-flex items-center px-1.5 py-0.5 rounded text-[9px] font-semibold bg-yellow-100 text-yellow-800","title","Producto suspendido",4,"ngIf"],[1,"px-3","py-2"],[1,"text-center"],[1,"text-gray-900","text-xs","font-medium"],["class","text-gray-500 text-[9px] mt-0.5 line-clamp-1",4,"ngIf"],[1,"px-3","py-2","text-center"],[1,"text-gray-700","text-xs"],[1,"px-2","py-2","text-center","bg-blue-50"],[1,"text-gray-900","font-semibold","text-xs"],[1,"text-gray-800","font-semibold","text-sm"],[1,"text-gray-800","font-semibold","text-xs"],[1,"text-gray-800","font-bold","text-xs"],[1,"px-2","py-2","text-center","bg-orange-50"],[3,"title"],["class","ml-1 inline-flex items-center","title","Stock agotado",4,"ngIf"],[1,"space-y-0.5"],[1,"text-xs"],[1,"text-gray-500","text-[9px]"],[1,"text-indigo-600","font-bold","text-xs","ml-0.5"],[1,"text-purple-600","font-bold","text-xs","ml-0.5"],[1,"text-blue-600","font-bold","text-xs","ml-0.5"],[1,"px-2","py-2"],[1,"flex","items-center","justify-center"],["class","w-4 h-4 text-gray-400","fill","currentColor","viewBox","0 0 24 24",4,"ngIf"],["class","w-4 h-4 text-green-500","fill","currentColor","viewBox","0 0 24 24",4,"ngIf"],[1,"flex","items-center","justify-center","gap-1"],["type","button","title","Editar producto",1,"p-1.5","text-purple-400","rounded","hover:bg-purple-50","border","border-gray-200",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-3.5","h-3.5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"],["type","button","title","Registrar movimiento de stock",1,"p-1.5","text-green-400","rounded","hover:bg-green-50","border","border-gray-200",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 6v6m0 0v6m0-6h6m-6 0H6"],[1,"inline-flex","relative","items-center","cursor-pointer"],["type","checkbox",1,"sr-only","peer",3,"change","checked"],[1,"w-8","h-4","bg-gray-200","rounded-full","peer-focus:outline-none","peer-focus:ring-1","peer-focus:ring-teal-500","peer-checked:bg-teal-500","relative","after:content-['']","after:absolute","after:top-[2px]","after:left-[2px]","after:bg-white","after:border-gray-300","after:border","after:rounded-full","after:h-3","after:w-3","after:transition-all","peer-checked:after:translate-x-4"],["title","Producto suspendido",1,"inline-flex","items-center","px-1.5","py-0.5","rounded","text-[9px]","font-semibold","bg-yellow-100","text-yellow-800"],[1,"text-gray-500","text-[9px]","mt-0.5","line-clamp-1"],["title","Stock agotado",1,"ml-1","inline-flex","items-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-red-500"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"],["fill","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-gray-400"],["cx","12","cy","12","r","10","fill","currentColor","opacity","0.2"],["d","M15.5 8.5l-7 7m0-7l7 7","stroke","currentColor","stroke-width","2","stroke-linecap","round"],["fill","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-green-500"],["d","M9 12l2 2 4-4","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round","fill","none"],[1,"py-12","px-6","text-center","text-gray-600"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-12","h-12","mx-auto","mb-4","text-blue-600"],[1,"m-0","mb-2","text-gray-900","font-semibold"],[1,"m-0","mb-6","text-gray-600"],["type","button","class","inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white border border-blue-600 rounded-lg cursor-pointer font-medium text-sm transition-all hover:bg-blue-700 hover:border-blue-700 hover:shadow-md",3,"click",4,"ngIf"],["type","button",1,"inline-flex","items-center","gap-2","px-4","py-2","bg-blue-600","text-white","border","border-blue-600","rounded-lg","cursor-pointer","font-medium","text-sm","transition-all","hover:bg-blue-700","hover:border-blue-700","hover:shadow-md",3,"click"],[1,"fixed","inset-0","z-[2000]","bg-black/50","backdrop-blur-sm","flex","items-center","justify-center","p-4",3,"click"],[1,"w-full","max-w-xl","bg-white","rounded-xl","shadow-xl","border","border-gray-200","overflow-hidden",3,"click"],[1,"flex","items-center","justify-between","p-4","md:p-5","border-b","border-gray-200"],[1,"text-xl","font-semibold","text-gray-900","flex","items-center","gap-2"],[1,"p-2","rounded-xl","bg-green-50","border","border-green-100"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-green-700"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"],["type","button","title","Cerrar",1,"text-gray-500","hover:bg-gray-100","hover:text-gray-900","rounded-lg","w-9","h-9","inline-flex","items-center","justify-center",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"p-4","md:p-5","space-y-4","max-h-[70vh]","overflow-y-auto"],[1,"bg-gray-50","rounded-lg","p-4","border","border-gray-200"],[1,"grid","grid-cols-2","gap-4"],[1,"block","mb-1","text-xs","font-medium","text-gray-500","uppercase"],[1,"text-sm","font-semibold","text-gray-900"],[1,"text-sm","font-bold","text-blue-600"],[1,"block","mb-2","text-sm","font-medium","text-gray-900"],[1,"text-red-500"],[1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","p-2.5",3,"ngModelChange","ngModel"],["value","ENTRADA"],["value","SALIDA"],["value","AJUSTE"],["type","number","min","0","step","1","required","","placeholder","Ingrese la cantidad",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","p-2.5",3,"ngModelChange","ngModel"],[1,"mt-2","p-3","bg-blue-50","border","border-blue-200","rounded-lg"],[1,"text-xs","text-gray-600","mb-1"],[1,"text-lg","font-bold","text-blue-700"],[1,"text-gray-400","text-xs","font-normal"],["type","text","placeholder","Ej: Devoluci\xF3n, Merma, Ajuste inventario, Reposici\xF3n...",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","p-2.5",3,"ngModelChange","ngModel"],["type","text","placeholder","Ej: Compra #123, Venta #456, Inventario f\xEDsico, Nota de cr\xE9dito...",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","p-2.5",3,"ngModelChange","ngModel"],[1,"flex","justify-end","gap-2","px-4","md:px-5","py-4","border-t","border-gray-200","bg-gray-50"],["type","button",1,"px-5","py-2.5","bg-gray-500","hover:bg-gray-600","text-white","font-medium","rounded-lg","text-sm","focus:outline-none","focus:ring-2","focus:ring-gray-500","transition-all","duration-200",3,"click"],["type","button",1,"flex","items-center","px-5","py-2.5","bg-green-600","hover:bg-green-700","text-white","font-medium","rounded-lg","text-sm","focus:outline-none","focus:ring-2","focus:ring-green-500","focus:ring-offset-2","transition-all","duration-200",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],[1,"fixed","inset-0","z-50","flex","items-center","justify-center","w-full","h-full","bg-black","bg-opacity-50","overflow-y-auto","overflow-x-hidden",3,"click"],[1,"relative","p-4","w-full","max-w-4xl",3,"click"],[1,"relative","bg-white","rounded-lg","shadow","border","border-gray-200"],[1,"flex","items-center","justify-between","p-4","md:p-5","border-b","border-gray-200","rounded-t"],[1,"text-xl","font-semibold","text-gray-900"],["type","button",1,"text-gray-400","bg-transparent","hover:bg-gray-200","hover:text-gray-900","rounded-lg","text-sm","w-8","h-8","ms-auto","inline-flex","justify-center","items-center",3,"click"],[1,"p-4","md:p-5","space-y-4","max-h-[70vh]","overflow-y-auto",3,"ngSubmit"],[1,"text-sm","font-semibold","text-gray-700","mb-3","flex","items-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","mr-2","text-blue-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"grid","grid-cols-1","gap-4","mb-4"],["type","text","name","nombre","required","","placeholder","Ej. Martillo de carpintero 16 oz",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","p-2.5",3,"ngModelChange","ngModel"],[1,"grid","grid-cols-2","md:grid-cols-3","gap-2","mb-4"],["type","text","name","codigo","readonly","","title","C\xF3digo generado autom\xE1ticamente",1,"bg-gray-100","border","border-gray-300","text-gray-600","text-sm","rounded-lg","block","w-full","p-2.5","cursor-not-allowed",3,"ngModelChange","ngModel","value"],["name","unidad_medida","required","",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","p-2.5",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["name","id_categoria","required","",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","p-2.5",3,"ngModelChange","ngModel"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["type","text","name","marca","placeholder","Ej. Stanley, Bosch, DeWalt",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","p-2.5",3,"ngModelChange","ngModel"],["name","id_proveedor",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","p-2.5",3,"ngModelChange","ngModel"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-2","mb-4"],[1,"relative"],[1,"absolute","left-3","top-2.5","text-gray-500","text-[10px]"],["type","number","step","0.01","min","0","name","precio_compra","placeholder","0.00",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","pl-8","p-2.5",3,"ngModelChange","ngModel"],["type","number","step","0.01","min","0","name","precio_unitario","required","","placeholder","0.00",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","pl-8","p-2.5",3,"ngModelChange","ngModel"],["type","number","step","0.01","min","0","name","precio_mayor","required","","placeholder","0.00",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","pl-8","p-2.5",3,"ngModelChange","ngModel"],["type","number","name","stock_actual","required","","min","0",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","p-2.5",3,"ngModelChange","blur","input","ngModel"],["class","mt-1 text-xs text-red-600 flex items-center gap-1",4,"ngIf"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-2","mb-4"],[1,"col-span-2"],["name","descripcion","rows","3","placeholder","Descripci\xF3n detallada del producto...",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","p-2.5",3,"ngModelChange","ngModel"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"],["type","text","name","material","placeholder","Ej. Acero, Pl\xE1stico, Madera",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","p-2.5",3,"ngModelChange","ngModel"],["type","number","step","0.01","min","0","name","peso","placeholder","0.00",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","p-2.5",3,"ngModelChange","ngModel"],["type","text","name","medidas","placeholder","Ej. 30x15x10 cm",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","p-2.5",3,"ngModelChange","ngModel"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"flex","items-center","gap-3"],["type","checkbox","name","tiene_caducidad",1,"w-5","h-5","text-blue-600","bg-gray-100","border-gray-300","rounded","focus:ring-blue-500",3,"ngModelChange","ngModel"],[1,"text-sm","text-gray-900","cursor-pointer"],["type","checkbox","name","tiene_garantia",1,"w-5","h-5","text-blue-600","bg-gray-100","border-gray-300","rounded","focus:ring-blue-500",3,"ngModelChange","ngModel"],[4,"ngIf"],[1,"flex","justify-center","pt-4","mb-4","border-t","border-gray-200"],["type","button",1,"px-5","py-2.5","bg-gray-500","hover:bg-gray-600","text-white","font-medium","rounded-lg","text-sm","focus:outline-none","focus:ring-2","focus:ring-gray-500","transition-all","duration-200","mr-3",3,"click"],["type","submit",1,"flex","items-center","px-5","py-2.5","bg-blue-600","hover:bg-blue-700","text-white","font-medium","rounded-lg","text-sm","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:ring-offset-2","transition-all","duration-200"],[3,"value"],[1,"mt-1","text-xs","text-red-600","flex","items-center","gap-1"],["type","date","name","fecha_vencimiento",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","p-2.5",3,"ngModelChange","ngModel"],["type","number","name","meses_garantia","min","0",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","p-2.5",3,"ngModelChange","ngModel"]],template:function(e,a){if(e&1){let o=k();t(0,"main",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div")(5,"h2",5)(6,"span",6),x(),t(7,"svg",7),g(8,"path",8),i(),n(9," Gesti\xF3n de Productos "),i()(),h(),t(10,"p",9),n(11," Administra y organiza tus productos de ferreter\xEDa "),i()()()(),t(12,"div",10)(13,"div",11)(14,"h3",12),x(),t(15,"svg",13),g(16,"path",14),i(),n(17," Resumen de Productos "),i(),h(),t(18,"div",15)(19,"div",16)(20,"span",17),n(21,"Total de Productos"),i(),t(22,"span",18),n(23),i()(),t(24,"div",16)(25,"span",17),n(26,"Stock Total"),i(),t(27,"span",19),n(28),i()(),t(29,"div",16)(30,"span",17),n(31,"Capital Invertido"),i(),t(32,"span",20)(33,"span",21),n(34,"S/"),i(),n(35),i()(),t(36,"div",16)(37,"span",17),n(38,"Valor Venta"),i(),t(39,"span",22)(40,"span",21),n(41,"S/"),i(),n(42),i()()()()(),t(43,"div",23)(44,"div",24)(45,"div",25)(46,"div",26)(47,"div",27),x(),t(48,"svg",28),g(49,"path",29),i(),h(),t(50,"span"),n(51,"REGISTROS"),i()(),S(52,ce,6,0,"div",30),i(),t(53,"div",31)(54,"label",32),x(),t(55,"svg",33),g(56,"path",34),i(),n(57," Buscar: "),h(),t(58,"input",35),v("ngModelChange",function(b){return m(o),f(a.terminoBusqueda,b)||(a.terminoBusqueda=b),u(b)}),y("ngModelChange",function(){return m(o),u(a.filtrarProductos())}),i()()(),t(59,"div",36),S(60,de,2,0,"div",37)(61,xe,41,1,"table",38)(62,fe,11,1,"ng-template",null,0,W),i()()()()()(),S(64,ve,67,7,"div",39)(65,Ce,140,27,"div",40)}if(e&2){let o=L(63);d(23),M(a.productos.length),d(5),w(" ",a.getTotalStock()," "),d(7),w(" ",a.getCapitalInvertido().toFixed(2)," "),d(7),w(" ",a.getValorVenta().toFixed(2)," "),d(10),p("ngIf",!a.modoEdicion&&!a.mostrarFormulario),d(6),_("ngModel",a.terminoBusqueda),d(2),p("ngIf",a.loading),d(),p("ngIf",!a.loading&&a.productosFiltrados.length)("ngIfElse",o),d(3),p("ngIf",a.mostrarModalMovimientoStock&&a.productoMovimientoStock),d(),p("ngIf",a.mostrarFormulario||a.modoEdicion)}},dependencies:[B,N,F,Z,U,J,K,O,$,R,Q,G,H,Y,X,q,z],encapsulation:2})};export{ne as ProductosComponent};
