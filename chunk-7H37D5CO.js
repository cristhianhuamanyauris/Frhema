import{a as W}from"./chunk-ZJ5CSXJS.js";import{c as L,f as P,i as A,j as G,k as $,o as B}from"./chunk-SMCZ5Z56.js";import{a as z}from"./chunk-5T4VIS3M.js";import{$a as N,Cb as k,Db as D,Ga as d,Gb as j,Ia as a,Ka as R,Ma as o,Na as i,O as w,Oa as S,Pa as v,Qa as M,Ra as s,T as C,W as U,Wa as l,Xa as T,Ya as p,_a as V,ab as O,ca as b,cb as F,da as x,ea as _,fa as E,wa as n,xa as y}from"./chunk-V3AN2ELD.js";import{a as h,b as I,h as u}from"./chunk-FK42CRUA.js";var f=class t{constructor(r){this.supabase=r}TABLE="roles";getRoles(){return u(this,null,function*(){let{data:r,error:e}=yield this.supabase.client.from(this.TABLE).select("*").order("id_rol",{ascending:!0});if(e)throw e;return r})}static \u0275fac=function(e){return new(e||t)(C(z))};static \u0275prov=w({token:t,factory:t.\u0275fac,providedIn:"root"})};function K(t,r){t&1&&(o(0,"span",12),l(1," SUPERADMIN (bloqueado) "),i())}function Q(t,r){if(t&1&&(o(0,"span",13),l(1),i()),t&2){let e=s().$implicit;R("bg-blue-100",e.roles==null?null:e.roles.nombre_rol)("text-blue-700",e.roles==null?null:e.roles.nombre_rol)("bg-gray-100",!(e.roles!=null&&e.roles.nombre_rol))("text-gray-700",!(e.roles!=null&&e.roles.nombre_rol)),n(),p(" ",(e.roles==null?null:e.roles.nombre_rol)||"SIN ROL"," ")}}function X(t,r){if(t&1&&(o(0,"select",14)(1,"option"),l(2),i()()),t&2){let e=s().$implicit;n(2),T(e.roles==null?null:e.roles.nombre_rol)}}function Y(t,r){if(t&1&&(o(0,"option",16),l(1),i()),t&2){let e=r.$implicit;a("ngValue",e.id_rol),n(),p(" ",e.nombre_rol," ")}}function Z(t,r){if(t&1){let e=v();o(0,"select",15),O("ngModelChange",function(m){b(e);let g=s().$implicit;return N(g.id_rol,m)||(g.id_rol=m),x(m)}),o(1,"option",16),l(2,"SIN ROL"),i(),d(3,Y,2,2,"option",17),i()}if(t&2){let e=s().$implicit,c=s();V("ngModel",e.id_rol),n(),a("ngValue",null),n(2),a("ngForOf",c.roles)}}function ee(t,r){t&1&&(o(0,"button",18),_(),o(1,"svg",19),S(2,"path",20),i(),l(3," Guardar "),i())}function te(t,r){if(t&1){let e=v();o(0,"button",21),M("click",function(){b(e);let m=s().$implicit,g=s();return x(g.guardarRol(m))}),_(),o(1,"svg",19),S(2,"path",20),i(),E(),o(3,"span"),l(4,"Guardar"),i()()}}function re(t,r){if(t&1&&(o(0,"tr",1)(1,"td",2),l(2),i(),o(3,"td",3),l(4),i(),o(5,"td",3),l(6),i(),o(7,"td",4),d(8,K,2,0,"span",5)(9,Q,2,9,"span",6),i(),o(10,"td",4),d(11,X,3,1,"select",7)(12,Z,4,3,"select",8),i(),o(13,"td",4)(14,"div",9),d(15,ee,4,0,"button",10)(16,te,5,0,"button",11),i()()()),t&2){let e=r.$implicit;n(2),p(" ",e.nombre_usuario," "),n(2),p(" ",e.nombre||"-"," "),n(2),p(" ",e.apellido||"-"," "),n(2),a("ngIf",e.esSuperadmin),n(),a("ngIf",!e.esSuperadmin),n(2),a("ngIf",e.esSuperadmin),n(),a("ngIf",!e.esSuperadmin),n(3),a("ngIf",e.esSuperadmin),n(),a("ngIf",!e.esSuperadmin)}}var H=class t{constructor(r,e){this.usuariosService=r;this.rolesService=e}usuarios=[];roles=[];loading=!0;SUPERADMIN_ID="e3a3f8f6-ded6-45fa-a2e3-5d873e6fab34";ngOnInit(){return u(this,null,function*(){yield this.cargarRoles(),yield this.cargarUsuarios()})}cargarRoles(){return u(this,null,function*(){this.roles=yield this.rolesService.getRoles()})}cargarUsuarios(){return u(this,null,function*(){this.loading=!0;let r=yield this.usuariosService.getUsuarios();this.usuarios=r.map(e=>I(h({},e),{esSuperadmin:e.id_usuario===this.SUPERADMIN_ID})),this.loading=!1})}guardarRol(r){return u(this,null,function*(){if(r.esSuperadmin){alert("\u26A0\uFE0F El superadmin no puede cambiar de rol.");return}try{yield this.usuariosService.actualizarRolUsuario(r.id_usuario,r.id_rol??null),alert("Rol actualizado correctamente");let e=localStorage.getItem("user_id");e&&e===r.id_usuario&&console.warn("Has cambiado tu propio rol. Vuelve a iniciar sesi\xF3n para aplicar cambios.")}catch(e){console.error(e),alert("Error al actualizar rol")}})}static \u0275fac=function(e){return new(e||t)(y(W),y(f))};static \u0275cmp=U({type:t,selectors:[["app-usuarios"]],standalone:!0,features:[F],decls:2,vars:1,consts:[["class","hover:bg-blue-50 transition-colors",4,"ngFor","ngForOf"],[1,"hover:bg-blue-50","transition-colors"],[1,"py-4","px-4","border-b","border-gray-100","align-middle","text-gray-900","text-sm","font-semibold"],[1,"py-4","px-4","border-b","border-gray-100","align-middle","text-gray-900","text-sm"],[1,"py-4","px-4","border-b","border-gray-100","align-middle"],["class","px-2 py-1 rounded-full text-xs font-semibold bg-purple-100 text-purple-700",4,"ngIf"],["class","px-2 py-1 rounded-full text-xs font-medium",3,"bg-blue-100","text-blue-700","bg-gray-100","text-gray-700",4,"ngIf"],["disabled","","class","px-3 py-2 rounded-lg border border-gray-300 bg-gray-100 text-gray-500 text-sm cursor-not-allowed",4,"ngIf"],["class","px-3 py-2 rounded-lg border border-gray-300 bg-gray-50 text-gray-900 outline-none text-sm transition-all focus:border-blue-600 focus:bg-white focus:ring-1 focus:ring-blue-200 hover:border-gray-400",3,"ngModel","ngModelChange",4,"ngIf"],[1,"flex","gap-2.5","justify-end"],["disabled","","class","border border-gray-200 bg-gray-100 text-gray-400 rounded-lg px-3.5 py-2 text-xs font-medium cursor-not-allowed flex items-center gap-2",4,"ngIf"],["class","border border-gray-300 bg-white text-gray-900 rounded-lg px-3.5 py-2 cursor-pointer inline-flex items-center gap-2 transition-all hover:-translate-y-0.5 hover:bg-gray-50 hover:border-gray-400 hover:shadow text-xs font-medium whitespace-nowrap","title","Guardar rol",3,"click",4,"ngIf"],[1,"px-2","py-1","rounded-full","text-xs","font-semibold","bg-purple-100","text-purple-700"],[1,"px-2","py-1","rounded-full","text-xs","font-medium"],["disabled","",1,"px-3","py-2","rounded-lg","border","border-gray-300","bg-gray-100","text-gray-500","text-sm","cursor-not-allowed"],[1,"px-3","py-2","rounded-lg","border","border-gray-300","bg-gray-50","text-gray-900","outline-none","text-sm","transition-all","focus:border-blue-600","focus:bg-white","focus:ring-1","focus:ring-blue-200","hover:border-gray-400",3,"ngModelChange","ngModel"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["disabled","",1,"border","border-gray-200","bg-gray-100","text-gray-400","rounded-lg","px-3.5","py-2","text-xs","font-medium","cursor-not-allowed","flex","items-center","gap-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-3.5","h-3.5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],["title","Guardar rol",1,"border","border-gray-300","bg-white","text-gray-900","rounded-lg","px-3.5","py-2","cursor-pointer","inline-flex","items-center","gap-2","transition-all","hover:-translate-y-0.5","hover:bg-gray-50","hover:border-gray-400","hover:shadow","text-xs","font-medium","whitespace-nowrap",3,"click"]],template:function(e,c){e&1&&(o(0,"tbody"),d(1,re,17,9,"tr",0),i()),e&2&&(n(),a("ngForOf",c.usuarios))},dependencies:[j,k,D,B,G,$,A,L,P],encapsulation:2})};export{H as UsuariosComponent};
