import{a as q}from"./chunk-ZJ5CSXJS.js";import{c as P,f as G,i as z,j as B,k as H,o as W}from"./chunk-SMCZ5Z56.js";import{a as $}from"./chunk-5T4VIS3M.js";import{$a as V,Cb as A,Db as D,Ga as m,Gb as L,Ia as l,Ka as h,Ma as t,Na as r,O as C,Oa as f,Pa as M,Qa as k,Ra as g,T as R,Va as N,W as U,Wa as o,Xa as w,Ya as b,_a as T,ab as F,ca as _,cb as O,da as v,ea as c,fa as x,ib as j,wa as a,xa as y}from"./chunk-V3AN2ELD.js";import{a as E,b as I,h as d}from"./chunk-FK42CRUA.js";var S=class i{constructor(n){this.supabase=n}TABLE="roles";getRoles(){return d(this,null,function*(){let{data:n,error:e}=yield this.supabase.client.from(this.TABLE).select("*").order("id_rol",{ascending:!0});if(e)throw e;return n})}static \u0275fac=function(e){return new(e||i)(R($))};static \u0275prov=C({token:i,factory:i.\u0275fac,providedIn:"root"})};function X(i,n){i&1&&(t(0,"div",17),o(1,"Cargando usuarios..."),r())}function Y(i,n){i&1&&(t(0,"span",32),o(1," SUPERADMIN "),r())}function Z(i,n){if(i&1&&(t(0,"option",27),o(1),r()),i&2){let e=n.$implicit;l("ngValue",e.id_rol),a(),b(" ",e.nombre_rol," ")}}function ee(i,n){if(i&1){let e=M();t(0,"tr",21)(1,"td",22),o(2),m(3,Y,2,0,"span",23),r(),t(4,"td",24),o(5),r(),t(6,"td",24),o(7),r(),t(8,"td",24)(9,"span",25),o(10),r()(),t(11,"td",24)(12,"select",26),F("ngModelChange",function(p){let u=_(e).$implicit;return V(u.id_rol,p)||(u.id_rol=p),v(p)}),t(13,"option",27),o(14,"SIN ROL"),r(),m(15,Z,2,2,"option",28),r()(),t(16,"td",24)(17,"button",29),k("click",function(){let p=_(e).$implicit,u=g(2);return v(u.guardarRol(p))}),c(),t(18,"svg",30),f(19,"path",31),r(),x(),t(20,"span"),o(21,"Guardar"),r()()()()}if(i&2){let e=n.$implicit,s=g(2);a(2),b(" ",e.nombre_usuario," "),a(),l("ngIf",e.esSuperadmin===!0),a(2),w(e.nombre||"-"),a(2),w(e.apellido||"-"),a(2),h("bg-purple-200",e.esSuperadmin===!0)("text-purple-800",e.esSuperadmin===!0)("bg-blue-100",(e.roles==null?null:e.roles.nombre_rol)&&e.esSuperadmin!==!0)("text-blue-700",(e.roles==null?null:e.roles.nombre_rol)&&e.esSuperadmin!==!0)("bg-gray-100",!(e.roles!=null&&e.roles.nombre_rol)),a(),b(" ",e.esSuperadmin===!0?"SUPERADMIN":(e.roles==null?null:e.roles.nombre_rol)||"SIN ROL"," "),a(2),T("ngModel",e.id_rol),l("disabled",e.esSuperadmin===!0),a(),l("ngValue",null),a(2),l("ngForOf",s.roles),a(2),h("opacity-50",e.esSuperadmin===!0),l("disabled",e.esSuperadmin===!0)}}function te(i,n){if(i&1&&(t(0,"table",18)(1,"thead")(2,"tr")(3,"th",19),o(4,"Usuario"),r(),t(5,"th",19),o(6,"Nombre"),r(),t(7,"th",19),o(8,"Apellido"),r(),t(9,"th",19),o(10,"Rol actual"),r(),t(11,"th",19),o(12,"Asignar rol"),r(),t(13,"th",19),o(14,"Acci\xF3n"),r()()(),t(15,"tbody"),m(16,ee,22,22,"tr",20),r()()),i&2){let e=g();a(16),l("ngForOf",e.usuarios)}}function re(i,n){i&1&&(t(0,"div",33)(1,"h3",34),o(2,"No hay usuarios registrados"),r()())}var J=class i{constructor(n,e){this.usuariosService=n;this.rolesService=e}usuarios=[];roles=[];loading=!0;SUPERADMIN_ID="e3a3f8f6-ded6-45fa-a2e3-5d873e6fab34";ngOnInit(){return d(this,null,function*(){yield this.cargarRoles(),yield this.cargarUsuarios()})}cargarRoles(){return d(this,null,function*(){this.roles=yield this.rolesService.getRoles()})}cargarUsuarios(){return d(this,null,function*(){this.loading=!0;let n=yield this.usuariosService.getUsuarios();this.usuarios=n.map(e=>I(E({},e),{esSuperadmin:e.id_usuario===this.SUPERADMIN_ID})),this.loading=!1})}guardarRol(n){return d(this,null,function*(){if(n.esSuperadmin){alert("\u26A0\uFE0F El superadmin no puede cambiar de rol.");return}try{yield this.usuariosService.actualizarRolUsuario(n.id_usuario,n.id_rol??null),alert("Rol actualizado correctamente");let e=localStorage.getItem("user_id");e&&e===n.id_usuario&&console.warn("Has cambiado tu propio rol. Vuelve a iniciar sesi\xF3n para aplicar cambios.")}catch(e){console.error(e),alert("Error al actualizar rol")}})}static \u0275fac=function(e){return new(e||i)(y(q),y(S))};static \u0275cmp=U({type:i,selectors:[["app-usuarios"]],standalone:!0,features:[O],decls:23,vars:3,consts:[["sinDatos",""],[1,"w-full","max-w-[1200px]","mx-auto","flex","flex-col","px-2","md:px-3","pb-2"],[1,"flex","items-start","justify-between","gap-4","px-0","py-3","pb-2","bg-transparent","border-none","shadow-none"],[1,"flex-1"],[1,"flex","items-center","gap-3"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-blue-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 12a3 3 0 11-6 0 3 3 0 016 0z"],[1,"m-0","text-2xl","font-semibold","text-gray-900","tracking-wide"],[1,"mt-1","mb-0","text-sm","text-gray-600"],[1,"flex","items-center","justify-between","px-0","py-1.5","mb-1.5","border-b","border-gray-200"],[1,"flex","items-center","text-gray-900","text-xs","font-semibold","uppercase","gap-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-gray-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"],[1,"rounded-none","border-none","bg-transparent","overflow-auto","shadow-none","px-0","pb-2"],["class","p-6 text-center text-gray-500",4,"ngIf"],["class","w-full border-collapse min-w-[960px]",4,"ngIf","ngIfElse"],[1,"p-6","text-center","text-gray-500"],[1,"w-full","border-collapse","min-w-[960px]"],[1,"text-left","text-xs","uppercase","py-3.5","px-4","border-b"],["class","hover:bg-blue-50 transition-colors",4,"ngFor","ngForOf"],[1,"hover:bg-blue-50","transition-colors"],[1,"py-4","px-4","border-b","font-semibold"],["class","ml-2 px-2 py-1 text-[10px] font-bold rounded-full bg-purple-100 text-purple-700 border border-purple-300",4,"ngIf"],[1,"py-4","px-4","border-b"],[1,"px-2","py-1","rounded-full","text-xs","font-medium"],[1,"px-3","py-2","rounded-lg","border","border-gray-300","bg-gray-50","text-gray-900","outline-none","text-sm",3,"ngModelChange","ngModel","disabled"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["title","Guardar rol",1,"border","border-gray-300","bg-white","text-gray-900","rounded-lg","px-3.5","py-2","inline-flex","items-center","gap-2","text-xs","font-medium",3,"click","disabled"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-3.5","h-3.5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],[1,"ml-2","px-2","py-1","text-[10px]","font-bold","rounded-full","bg-purple-100","text-purple-700","border","border-purple-300"],[1,"py-12","px-6","text-center","text-gray-600"],[1,"mb-2","font-semibold"]],template:function(e,s){if(e&1&&(t(0,"div",1)(1,"header",2)(2,"div",3)(3,"div",4),c(),t(4,"svg",5),f(5,"path",6)(6,"path",7),r(),x(),t(7,"div")(8,"h1",8),o(9,"Gesti\xF3n de Usuarios y Roles"),r(),t(10,"p",9),o(11,"Administra usuarios y asigna roles del sistema."),r()()()()(),t(12,"div",10)(13,"div",11),c(),t(14,"svg",12),f(15,"path",13),r(),x(),t(16,"span"),o(17,"REGISTROS"),r()()(),t(18,"section",14),m(19,X,2,0,"div",15)(20,te,17,1,"table",16)(21,re,3,0,"ng-template",null,0,j),r()()),e&2){let p=N(22);a(19),l("ngIf",s.loading),a(),l("ngIf",!s.loading&&s.usuarios.length)("ngIfElse",p)}},dependencies:[L,A,D,W,B,H,z,P,G],encapsulation:2})};export{J as UsuariosComponent};
