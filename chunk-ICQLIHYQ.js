import{a as K}from"./chunk-IUL6OELX.js";import{a as J}from"./chunk-XD37HBIP.js";import{a as U}from"./chunk-KKIOE5AM.js";import{b as A,c as N,f as O,h as W,i as B,j as G,k as R,l as z,o as q}from"./chunk-SMCZ5Z56.js";import"./chunk-5T4VIS3M.js";import{$a as _,Cb as P,Db as H,Eb as F,Ga as h,Gb as j,Ia as v,Ma as e,Na as t,Oa as g,Pa as M,Qa as S,Ra as w,Va as k,W as D,Wa as r,Ya as s,_a as f,ab as y,ca as b,cb as V,da as x,ea as c,fa as u,fb as T,gb as I,ib as L,wa as l,xa as E}from"./chunk-V3AN2ELD.js";import{h as C}from"./chunk-FK42CRUA.js";function X(a,n){if(a&1&&(e(0,"option",43),r(1),t()),a&2){let i=n.$implicit;v("value",i.id_proveedor),l(),s(" ",i.nombre," ")}}function Y(a,n){if(a&1&&(e(0,"option",43),r(1),t()),a&2){let i=n.$implicit;v("value",i.id_producto),l(),s(" ",i.nombre," ")}}function Z(a,n){if(a&1){let i=M();e(0,"tr",47)(1,"td",48)(2,"div",49),r(3),t()(),e(4,"td",50),r(5),t(),e(6,"td",50),r(7),t(),e(8,"td",51),r(9),t(),e(10,"td",52)(11,"div",53)(12,"button",54),S("click",function(){let m=b(i).index,p=w(2);return x(p.eliminarDetalle(m))}),c(),e(13,"svg",55),g(14,"path",56),t(),u(),e(15,"span"),r(16,"Eliminar"),t()()()()()}if(a&2){let i=n.$implicit,o=w(2);l(3),s(" ",o.getNombreProducto(i.id_producto)," "),l(2),s(" ",i.cantidad," "),l(2),s(" S/. ",i.costo_unitario," "),l(2),s(" S/. ",i.subtotal," ")}}function $(a,n){if(a&1&&(e(0,"table",44)(1,"thead")(2,"tr")(3,"th",45),r(4," Producto "),t(),e(5,"th",45),r(6," Cant. "),t(),e(7,"th",45),r(8," Costo "),t(),e(9,"th",45),r(10," Subtotal "),t(),e(11,"th",45),r(12," Acciones "),t()()(),e(13,"tbody"),h(14,Z,17,4,"tr",46),t()()),a&2){let i=w();l(14),v("ngForOf",i.detalles)}}function ee(a,n){a&1&&(e(0,"div",57),c(),e(1,"svg",58),g(2,"path",28),t(),u(),e(3,"h3",59),r(4,"Sin detalle agregado"),t(),e(5,"p",60),r(6,"Agrega productos para construir la compra."),t()())}function te(a,n){if(a&1&&(e(0,"tr",47)(1,"td",50),r(2),t(),e(3,"td",48)(4,"div",49),r(5),t()(),e(6,"td",50),r(7),T(8,"date"),t(),e(9,"td",50),r(10),t(),e(11,"td",51),r(12),t()()),a&2){let i=n.$implicit;l(2),s(" ",i.id_compra," "),l(3),s(" ",(i.proveedores==null?null:i.proveedores.nombre)||"-"," "),l(2),s(" ",I(8,5,i.fecha,"short")," "),l(3),s(" ",i.nro_documento||"-"," "),l(2),s(" S/. ",i.total," ")}}function re(a,n){if(a&1&&(e(0,"table",61)(1,"thead")(2,"tr")(3,"th",45),r(4," ID "),t(),e(5,"th",45),r(6," Proveedor "),t(),e(7,"th",45),r(8," Fecha "),t(),e(9,"th",45),r(10," Documento "),t(),e(11,"th",45),r(12," Total "),t()()(),e(13,"tbody"),h(14,te,13,8,"tr",46),t()()),a&2){let i=w();l(14),v("ngForOf",i.compras)}}function ie(a,n){a&1&&(e(0,"div",62),c(),e(1,"svg",63),g(2,"path",41),t(),u(),e(3,"h3",59),r(4,"No hay compras registradas"),t(),e(5,"p",60),r(6,"Aqu\xED aparecer\xE1n tus compras guardadas."),t()())}var Q=class a{constructor(n,i,o){this.comprasService=n;this.proveedoresService=i;this.productosService=o}compras=[];proveedores=[];productos=[];compra={id_proveedor:0,id_usuario:"",nro_documento:"",total:0};detalles=[];nuevoDetalle={id_producto:0,cantidad:1,costo_unitario:0};ngOnInit(){return C(this,null,function*(){this.compra.id_usuario=localStorage.getItem("user_id")??"",this.proveedores=yield this.proveedoresService.getProveedores(),this.productos=yield this.productosService.getProductos(),this.cargarCompras()})}cargarCompras(){return C(this,null,function*(){this.compras=yield this.comprasService.getCompras()})}getNombreProducto(n){let i=this.productos.find(o=>o.id_producto===n);return i?i.nombre:""}agregarDetalle(){if(!this.nuevoDetalle.id_producto){alert("Seleccione un producto");return}let n=this.nuevoDetalle.cantidad*this.nuevoDetalle.costo_unitario;this.detalles.push({id_producto:this.nuevoDetalle.id_producto,cantidad:this.nuevoDetalle.cantidad,costo_unitario:this.nuevoDetalle.costo_unitario,subtotal:n}),this.nuevoDetalle={id_producto:0,cantidad:1,costo_unitario:0},this.calcularTotal()}eliminarDetalle(n){this.detalles.splice(n,1),this.calcularTotal()}calcularTotal(){this.compra.total=this.detalles.reduce((n,i)=>n+(i.subtotal??0),0)}limpiarFormulario(){this.compra={id_proveedor:0,id_usuario:this.compra.id_usuario,nro_documento:"",total:0},this.detalles=[],this.nuevoDetalle={id_producto:0,cantidad:1,costo_unitario:0}}guardarCompra(){return C(this,null,function*(){if(!this.compra.id_proveedor){alert("Seleccione un proveedor");return}if(this.detalles.length===0){alert("Agregue productos");return}try{let n=yield this.comprasService.registrarCompra(this.compra,this.detalles);alert("Compra registrada #"+n),this.limpiarFormulario(),this.cargarCompras()}catch(n){console.error(n),alert("Error al registrar compra")}})}static \u0275fac=function(i){return new(i||a)(E(K),E(J),E(U))};static \u0275cmp=D({type:a,selectors:[["app-compras-list"]],standalone:!0,features:[V],decls:80,vars:12,consts:[["sinDetalles",""],["sinHistorial",""],[1,"w-full","max-w-[1200px]","mx-auto","flex","flex-col","px-2","md:px-3","pb-2"],[1,"flex","items-start","justify-between","gap-4","px-0","pt-0","pb-2","bg-transparent","border-none","shadow-none"],[1,"flex-1"],[1,"flex","items-center","gap-3"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-blue-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2M7 7h10M5 3h14a2 2 0 012 2v14a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2z"],[1,"m-0","text-2xl","font-semibold","text-gray-900","tracking-wide"],[1,"mt-1","mb-0","text-sm","text-gray-600"],[1,"flex","items-center","justify-between","px-0","py-1.5","mb-2","border-b","border-gray-200"],[1,"flex","items-center","text-gray-900","text-xs","font-semibold","uppercase","gap-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-gray-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"],[1,"flex","items-center","gap-2"],["type","button","title","Limpiar formulario",1,"inline-flex","items-center","gap-2","px-4","py-2","bg-white","border","border-gray-300","text-gray-900","rounded-lg","cursor-pointer","font-medium","text-sm","transition-all","hover:-translate-y-0.5","hover:bg-gray-50","hover:border-gray-400","hover:shadow-md",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],["type","button","title","Guardar compra",1,"inline-flex","items-center","gap-2","px-4","py-2","bg-blue-600","text-white","border","border-blue-600","rounded-lg","cursor-pointer","font-medium","text-sm","transition-all","hover:-translate-y-0.5","hover:bg-blue-700","hover:border-blue-700","hover:shadow-md",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],[1,"px-0","pb-3"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-3"],[1,"mb-0"],[1,"block","mb-2","text-gray-900","text-sm","font-medium","leading-6"],["name","id_proveedor",1,"w-full","px-3","py-2.5","rounded-lg","border","border-gray-300","bg-gray-50","text-gray-900","outline-none","text-sm","transition-all","box-border","focus:border-blue-600","focus:bg-white","focus:ring-1","focus:ring-blue-200","hover:border-gray-400",3,"ngModelChange","ngModel"],["value","0"],[3,"value",4,"ngFor","ngForOf"],["type","text","name","nro_documento","placeholder","Ej: F001-000123",1,"w-full","px-3","py-2.5","rounded-lg","border","border-gray-300","bg-gray-50","text-gray-900","outline-none","text-sm","transition-all","box-border","focus:border-blue-600","focus:bg-white","focus:ring-1","focus:ring-blue-200","hover:border-gray-400",3,"ngModelChange","ngModel"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"],[1,"text-right"],[1,"text-xs","text-gray-600"],[1,"text-lg","font-semibold","text-gray-900"],[1,"flex","flex-wrap","gap-2","p-3","border","border-gray-200","rounded-lg","bg-white"],[1,"flex-1","min-w-[220px]","px-3","py-2.5","rounded-lg","border","border-gray-300","bg-gray-50","text-gray-900","outline-none","text-sm","transition-all","focus:border-blue-600","focus:bg-white","focus:ring-1","focus:ring-blue-200","hover:border-gray-400",3,"ngModelChange","ngModel"],["type","number","min","1","placeholder","Cantidad",1,"w-[130px]","px-3","py-2.5","rounded-lg","border","border-gray-300","bg-gray-50","text-gray-900","outline-none","text-sm","transition-all","focus:border-blue-600","focus:bg-white","focus:ring-1","focus:ring-blue-200","hover:border-gray-400",3,"ngModelChange","ngModel"],["type","number","min","0","step","0.01","placeholder","Costo",1,"w-[140px]","px-3","py-2.5","rounded-lg","border","border-gray-300","bg-gray-50","text-gray-900","outline-none","text-sm","transition-all","focus:border-blue-600","focus:bg-white","focus:ring-1","focus:ring-blue-200","hover:border-gray-400",3,"ngModelChange","ngModel"],["type","button",1,"inline-flex","items-center","gap-2","px-4","py-2","bg-blue-600","text-white","border","border-blue-600","rounded-lg","cursor-pointer","font-medium","text-sm","transition-all","hover:-translate-y-0.5","hover:bg-blue-700","hover:border-blue-700","hover:shadow-md",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],[1,"rounded-none","border-none","bg-transparent","overflow-auto","shadow-none","px-0","pb-2"],["class","w-full border-collapse min-w-[860px]",4,"ngIf","ngIfElse"],[1,"flex","items-center","justify-between","px-0","py-1.5","mt-2","mb-2","border-b","border-gray-200"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"],["class","w-full border-collapse min-w-[960px]",4,"ngIf","ngIfElse"],[3,"value"],[1,"w-full","border-collapse","min-w-[860px]"],[1,"text-left","text-xs","tracking-wider","uppercase","text-gray-600","py-3.5","px-4","bg-transparent","sticky","top-0","border-b","border-gray-200","font-semibold"],["class","hover:bg-blue-50 transition-colors",4,"ngFor","ngForOf"],[1,"hover:bg-blue-50","transition-colors"],[1,"py-4","px-4","border-b","border-gray-100","align-middle","text-gray-900","text-sm"],[1,"font-semibold","text-gray-900","tracking-wide","leading-snug"],[1,"py-4","px-4","border-b","border-gray-100","align-middle","text-gray-600","text-sm"],[1,"py-4","px-4","border-b","border-gray-100","align-middle","text-gray-900","text-sm","font-semibold"],[1,"py-4","px-4","border-b","border-gray-100","align-middle"],[1,"flex","gap-2.5","justify-end"],["type","button","title","Eliminar",1,"border","border-red-300","bg-red-50","text-red-700","rounded-lg","px-3.5","py-2","cursor-pointer","inline-flex","items-center","gap-2","transition-all","hover:-translate-y-0.5","hover:bg-red-100","hover:border-red-400","hover:shadow","text-xs","font-medium","whitespace-nowrap",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-3.5","h-3.5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"],[1,"py-10","px-6","text-center","text-gray-600","border","border-dashed","border-gray-300","rounded-lg","bg-white"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-10","h-10","mx-auto","mb-3","text-blue-600"],[1,"m-0","mb-2","text-gray-900","font-semibold"],[1,"m-0","text-gray-600"],[1,"w-full","border-collapse","min-w-[960px]"],[1,"py-12","px-6","text-center","text-gray-600","border","border-dashed","border-gray-300","rounded-lg","bg-white"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-12","h-12","mx-auto","mb-4","text-blue-600"]],template:function(i,o){if(i&1){let m=M();e(0,"div",2)(1,"header",3)(2,"div",4)(3,"div",5),c(),e(4,"svg",6),g(5,"path",7),t(),u(),e(6,"div")(7,"h1",8),r(8,"Registro de Compras"),t(),e(9,"p",9),r(10,"Registra compras, agrega detalle y revisa el historial."),t()()()()(),e(11,"div",10)(12,"div",11),c(),e(13,"svg",12),g(14,"path",13),t(),u(),e(15,"span"),r(16,"NUEVA COMPRA"),t()(),e(17,"div",14)(18,"button",15),S("click",function(){return b(m),x(o.limpiarFormulario())}),c(),e(19,"svg",16),g(20,"path",17),t(),u(),e(21,"span"),r(22,"Limpiar"),t()(),e(23,"button",18),S("click",function(){return b(m),x(o.guardarCompra())}),c(),e(24,"svg",16),g(25,"path",19),t(),u(),e(26,"span"),r(27,"Guardar"),t()()()(),e(28,"section",20)(29,"div",21)(30,"div",22)(31,"label",23),r(32,"Proveedor"),t(),e(33,"select",24),y("ngModelChange",function(d){return b(m),_(o.compra.id_proveedor,d)||(o.compra.id_proveedor=d),x(d)}),e(34,"option",25),r(35,"Seleccione proveedor"),t(),h(36,X,2,2,"option",26),t()(),e(37,"div",22)(38,"label",23),r(39,"N\xB0 Documento"),t(),e(40,"input",27),y("ngModelChange",function(d){return b(m),_(o.compra.nro_documento,d)||(o.compra.nro_documento=d),x(d)}),t()()()(),e(41,"div",10)(42,"div",11),c(),e(43,"svg",12),g(44,"path",28),t(),u(),e(45,"span"),r(46,"DETALLE DE COMPRA"),t()(),e(47,"div",14)(48,"div",29)(49,"div",30),r(50,"Total"),t(),e(51,"div",31),r(52),t()()()(),e(53,"section",20)(54,"div",32)(55,"select",33),y("ngModelChange",function(d){return b(m),_(o.nuevoDetalle.id_producto,d)||(o.nuevoDetalle.id_producto=d),x(d)}),e(56,"option",25),r(57,"Producto"),t(),h(58,Y,2,2,"option",26),t(),e(59,"input",34),y("ngModelChange",function(d){return b(m),_(o.nuevoDetalle.cantidad,d)||(o.nuevoDetalle.cantidad=d),x(d)}),t(),e(60,"input",35),y("ngModelChange",function(d){return b(m),_(o.nuevoDetalle.costo_unitario,d)||(o.nuevoDetalle.costo_unitario=d),x(d)}),t(),e(61,"button",36),S("click",function(){return b(m),x(o.agregarDetalle())}),c(),e(62,"svg",16),g(63,"path",37),t(),u(),e(64,"span"),r(65,"Agregar"),t()()()(),e(66,"section",38),h(67,$,15,1,"table",39)(68,ee,7,0,"ng-template",null,0,L),t(),e(70,"div",40)(71,"div",11),c(),e(72,"svg",12),g(73,"path",41),t(),u(),e(74,"span"),r(75,"HISTORIAL DE COMPRAS"),t()()(),e(76,"section",38),h(77,re,15,1,"table",42)(78,ie,7,0,"ng-template",null,1,L),t()()}if(i&2){let m=k(69),p=k(79);l(33),f("ngModel",o.compra.id_proveedor),l(3),v("ngForOf",o.proveedores),l(4),f("ngModel",o.compra.nro_documento),l(12),s(" S/. ",(o.compra.total||0).toFixed(2)," "),l(3),f("ngModel",o.nuevoDetalle.id_producto),l(3),v("ngForOf",o.productos),l(),f("ngModel",o.nuevoDetalle.cantidad),l(),f("ngModel",o.nuevoDetalle.costo_unitario),l(7),v("ngIf",o.detalles==null?null:o.detalles.length)("ngIfElse",m),l(10),v("ngIf",o.compras==null?null:o.compras.length)("ngIfElse",p)}},dependencies:[j,P,H,F,q,G,R,A,W,B,N,z,O],encapsulation:2})};export{Q as ComprasListComponent};
