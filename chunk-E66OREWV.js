import{a as te}from"./chunk-IUL6OELX.js";import{a as ee}from"./chunk-XD37HBIP.js";import{a as Z}from"./chunk-IELP24VO.js";import{a as Y}from"./chunk-KKIOE5AM.js";import{a as $}from"./chunk-ICTQ4SKP.js";import{a as D,b as B,c as O,d as A,e as G,f as H,g as R,h as z,i as q,j as U,k as J,l as K,m as Q,o as X}from"./chunk-SMCZ5Z56.js";import"./chunk-5T4VIS3M.js";import{$a as x,Cb as F,Db as N,Ga as v,Gb as j,Ia as p,La as T,Ma as t,Na as i,Oa as g,Pa as C,Qa as y,Ra as s,Va as I,W as V,Wa as n,Xa as S,Ya as w,_a as _,ab as f,ca as m,cb as W,da as u,ea as b,fa as h,ib as L,wa as c,xa as k}from"./chunk-V3AN2ELD.js";import{a as P,h as E}from"./chunk-FK42CRUA.js";function ie(l,r){if(l&1){let e=C();t(0,"div",40)(1,"button",41),y("click",function(){m(e);let o=s();return u(o.nuevoProducto())}),b(),t(2,"svg",28),g(3,"path",42),i(),h(),t(4,"span"),n(5,"NUEVO PRODUCTO"),i()()()}}function re(l,r){l&1&&(t(0,"div",43),n(1,"Cargando productos..."),i())}function ne(l,r){if(l&1&&(t(0,"div",77),n(1),i()),l&2){let e=s().$implicit;c(),S(e.descripcion)}}function ae(l,r){l&1&&(t(0,"span",78),b(),t(1,"svg",79),g(2,"path",80),i()())}function de(l,r){if(l&1){let e=C();t(0,"tr",56)(1,"td",57),n(2),i(),t(3,"td",46)(4,"div",58)(5,"span",59),n(6),i(),v(7,ne,2,1,"div",60),i()(),t(8,"td",47)(9,"span",61),n(10),i()(),t(11,"td",62)(12,"span",63),n(13),i()(),t(14,"td",62)(15,"span",64),n(16),i()(),t(17,"td",62)(18,"span",65),n(19),i()(),t(20,"td",62)(21,"span",66),n(22),i()(),t(23,"td",67)(24,"span",63),n(25),i()(),t(26,"td",67)(27,"span",68),n(28),i(),v(29,ae,3,0,"span",69),i(),t(30,"td",67)(31,"span",70),n(32),i()(),t(33,"td",67)(34,"span",71),n(35),i()(),t(36,"td",53)(37,"div",72)(38,"button",73),y("click",function(){let o=m(e).$implicit,d=s(2);return u(d.editarProducto(o))}),b(),t(39,"svg",33),g(40,"path",74),i()(),h(),t(41,"button",75),y("click",function(){let o=m(e).$implicit,d=s(2);return u(d.eliminarProducto(o.id_producto))}),b(),t(42,"svg",33),g(43,"path",76),i()()()()()}if(l&2){let e=r.$implicit,a=s(2);c(2),S(e.codigo),c(4),S(e.nombre),c(),p("ngIf",e.descripcion),c(3),S(e.marca||"-"),c(3),S(e.unidad_medida),c(3),S(a.getIngresoComprado(e)||0),c(3),w("S/ ",a.getPrecioCompraPromedio(e).toFixed(2),""),c(3),w("S/ ",a.getTotalCompraHistorica(e).toFixed(2),""),c(3),S(e.unidad_medida),c(2),T((e.stock_actual||0)<=0?"text-red-600 font-bold text-base":"text-blue-600 font-bold text-base"),p("title",(e.stock_actual||0)<=0?"Stock en CERO o negativo":""),c(),w(" ",a.getStockActual(e)," "),c(),p("ngIf",(e.stock_actual||0)<=0),c(3),w("S/ ",(e.precio_unitario||0).toFixed(2),""),c(3),w("S/ ",a.getTotalVentaNormal(e).toFixed(2),"")}}function ce(l,r){if(l&1&&(t(0,"table",44)(1,"thead")(2,"tr",45)(3,"th",46),n(4,"C\xF3digo"),i(),t(5,"th",47),n(6,"Descripci\xF3n"),i(),t(7,"th",47),n(8,"Marca"),i(),t(9,"th",48),n(10,"UND - COMPRA"),i(),t(11,"th",49),n(12,"TOTAL DE MATERIALES A VENDER"),i(),t(13,"th",50),n(14,"Acciones"),i()(),t(15,"tr",45),g(16,"th",46)(17,"th",46)(18,"th",46),t(19,"th",51),n(20,"Unidad"),i(),t(21,"th",51),n(22,"Cantidad"),i(),t(23,"th",51),n(24,"Precio"),i(),t(25,"th",51),n(26,"Total"),i(),t(27,"th",52),n(28,"Unidad"),i(),t(29,"th",52),n(30,"Cantidad"),i(),t(31,"th",52),n(32,"Precio"),i(),t(33,"th",52),n(34,"Total"),i(),g(35,"th",53),i()(),t(36,"tbody",54),v(37,de,44,16,"tr",55),i()()),l&2){let e=s();c(37),p("ngForOf",e.productosFiltrados)}}function le(l,r){if(l&1){let e=C();t(0,"button",86),y("click",function(){m(e);let o=s(2);return u(o.nuevoProducto())}),b(),t(1,"svg",33),g(2,"path",42),i(),h(),t(3,"span"),n(4,"Nuevo Producto"),i()()}}function se(l,r){if(l&1&&(t(0,"div",81),b(),t(1,"svg",82),g(2,"path",8),i(),h(),t(3,"h3",83),n(4,"No hay productos registrados"),i(),t(5,"p",84),n(6,"Crea uno con el bot\xF3n "),t(7,"b"),n(8,"Nuevo Producto"),i(),n(9,"."),i(),v(10,le,5,0,"button",85),i()),l&2){let e=s();c(10),p("ngIf",!e.modoEdicion)}}function me(l,r){if(l&1&&(t(0,"option",139),n(1),i()),l&2){let e=r.$implicit;p("value",e),c(),S(e)}}function ue(l,r){if(l&1&&(t(0,"option",108),n(1),i()),l&2){let e=r.$implicit;p("ngValue",e.id_categoria),c(),S(e.nombre)}}function pe(l,r){if(l&1&&(t(0,"option",108),n(1),i()),l&2){let e=r.$implicit;p("ngValue",e.id_proveedor),c(),S(e.nombre)}}function ge(l,r){l&1&&(t(0,"p",140),b(),t(1,"svg",33),g(2,"path",80),i(),h(),t(3,"span"),n(4,"El stock est\xE1 en CERO. No se podr\xE1n realizar ventas hasta que se reponga stock."),i()())}function _e(l,r){if(l&1){let e=C();t(0,"div")(1,"label",100),n(2,"Fecha de Vencimiento"),i(),t(3,"input",141),f("ngModelChange",function(o){m(e);let d=s(2);return x(d.producto.fecha_vencimiento,o)||(d.producto.fecha_vencimiento=o),u(o)}),i()()}if(l&2){let e=s(2);c(3),_("ngModel",e.producto.fecha_vencimiento)}}function xe(l,r){if(l&1){let e=C();t(0,"div")(1,"label",100),n(2,"Meses de Garant\xEDa"),i(),t(3,"input",142),f("ngModelChange",function(o){m(e);let d=s(2);return x(d.producto.meses_garantia,o)||(d.producto.meses_garantia=o),u(o)}),i()()}if(l&2){let e=s(2);c(3),_("ngModel",e.producto.meses_garantia)}}function fe(l,r){if(l&1){let e=C();t(0,"div",87),y("click",function(){m(e);let o=s();return o.mostrarFormulario=!1,o.modoEdicion=!1,u(o.producto=o.getEmptyProducto())}),t(1,"div",88),y("click",function(o){return m(e),u(o.stopPropagation())}),t(2,"div",89)(3,"div",90)(4,"h3",91),b(),t(5,"svg",13),g(6,"path",8),i(),n(7),i(),h(),t(8,"button",92),y("click",function(){m(e);let o=s();return o.mostrarFormulario=!1,o.modoEdicion=!1,u(o.producto=o.getEmptyProducto())}),b(),t(9,"svg",93),g(10,"path",94),i()()(),h(),t(11,"form",95),y("ngSubmit",function(){m(e);let o=s();return u(o.guardarProducto())}),t(12,"div",31)(13,"h4",96),b(),t(14,"svg",97),g(15,"path",98),i(),n(16," Informaci\xF3n B\xE1sica "),i(),h(),t(17,"div",99)(18,"div")(19,"label",100),n(20," Nombre del Producto "),t(21,"span",101),n(22,"*"),i()(),t(23,"input",102),f("ngModelChange",function(o){m(e);let d=s();return x(d.producto.nombre,o)||(d.producto.nombre=o),u(o)}),i()()(),t(24,"div",103)(25,"div")(26,"label",100),n(27," C\xF3digo (Auto-generado) "),i(),t(28,"input",104),f("ngModelChange",function(o){m(e);let d=s();return x(d.producto.codigo,o)||(d.producto.codigo=o),u(o)}),i()(),t(29,"div")(30,"label",100),n(31," Und. Medida "),t(32,"span",101),n(33,"*"),i()(),t(34,"select",105),f("ngModelChange",function(o){m(e);let d=s();return x(d.producto.unidad_medida,o)||(d.producto.unidad_medida=o),u(o)}),v(35,me,2,2,"option",106),i()(),t(36,"div")(37,"label",100),n(38," Categor\xEDa "),t(39,"span",101),n(40,"*"),i()(),t(41,"select",107),f("ngModelChange",function(o){m(e);let d=s();return x(d.producto.id_categoria,o)||(d.producto.id_categoria=o),u(o)}),t(42,"option",108),n(43,"Seleccione una categor\xEDa..."),i(),v(44,ue,2,2,"option",109),i()(),t(45,"div")(46,"label",100),n(47," Marca "),i(),t(48,"input",110),f("ngModelChange",function(o){m(e);let d=s();return x(d.producto.marca,o)||(d.producto.marca=o),u(o)}),i()(),t(49,"div")(50,"label",100),n(51,"Proveedor"),i(),t(52,"select",111),f("ngModelChange",function(o){m(e);let d=s();return x(d.producto.id_proveedor,o)||(d.producto.id_proveedor=o),u(o)}),t(53,"option",108),n(54,"-- Seleccione --"),i(),v(55,pe,2,2,"option",109),i()()()(),t(56,"div",31)(57,"h4",96),b(),t(58,"svg",97),g(59,"path",112),i(),n(60," Precios y Stock "),i(),h(),t(61,"div",113)(62,"div")(63,"label",100),n(64," Precio de Compra "),i(),t(65,"div",114)(66,"span",115),n(67,"S/"),i(),t(68,"input",116),f("ngModelChange",function(o){m(e);let d=s();return x(d.producto.precio_compra,o)||(d.producto.precio_compra=o),u(o)}),i()()(),t(69,"div")(70,"label",100),n(71," Precio de Venta "),t(72,"span",101),n(73,"*"),i()(),t(74,"div",114)(75,"span",115),n(76,"S/"),i(),t(77,"input",117),f("ngModelChange",function(o){m(e);let d=s();return x(d.producto.precio_unitario,o)||(d.producto.precio_unitario=o),u(o)}),i()()(),t(78,"div")(79,"label",100),n(80," Precio Venta x Mayor "),t(81,"span",101),n(82,"*"),i()(),t(83,"div",114)(84,"span",115),n(85,"S/"),i(),t(86,"input",118),f("ngModelChange",function(o){m(e);let d=s();return x(d.producto.precio_mayor,o)||(d.producto.precio_mayor=o),u(o)}),i()()(),t(87,"div")(88,"label",100),n(89," Stock Inicial "),t(90,"span",101),n(91,"*"),i()(),t(92,"input",119),f("ngModelChange",function(o){m(e);let d=s();return x(d.producto.stock_actual,o)||(d.producto.stock_actual=o),u(o)}),y("blur",function(){m(e);let o=s();return u(o.validarStock())})("input",function(){m(e);let o=s();return u(o.validarStock())}),i(),v(93,ge,5,0,"p",120),i()(),t(94,"div",121)(95,"div",122)(96,"label",100),n(97,"Descripci\xF3n"),i(),t(98,"textarea",123),f("ngModelChange",function(o){m(e);let d=s();return x(d.producto.descripcion,o)||(d.producto.descripcion=o),u(o)}),i()()()(),t(99,"div",31)(100,"h4",96),b(),t(101,"svg",97),g(102,"path",124),i(),n(103," Informaci\xF3n Adicional (Ferreter\xEDa) "),i(),h(),t(104,"div",121)(105,"div")(106,"label",100),n(107," Material "),i(),t(108,"input",125),f("ngModelChange",function(o){m(e);let d=s();return x(d.producto.material,o)||(d.producto.material=o),u(o)}),i()(),t(109,"div")(110,"label",100),n(111," Peso (kg) "),i(),t(112,"input",126),f("ngModelChange",function(o){m(e);let d=s();return x(d.producto.peso,o)||(d.producto.peso=o),u(o)}),i()(),t(113,"div")(114,"label",100),n(115," Medidas (LxAxA) "),i(),t(116,"input",127),f("ngModelChange",function(o){m(e);let d=s();return x(d.producto.medidas,o)||(d.producto.medidas=o),u(o)}),i()()()(),t(117,"div",31)(118,"h4",96),b(),t(119,"svg",97),g(120,"path",128),i(),n(121," Caducidad y Garant\xEDa "),i(),h(),t(122,"div",129)(123,"div",130)(124,"input",131),f("ngModelChange",function(o){m(e);let d=s();return x(d.producto.tiene_caducidad,o)||(d.producto.tiene_caducidad=o),u(o)}),i(),t(125,"label",132),n(126," \xBFTiene caducidad? "),i()(),t(127,"div",130)(128,"input",133),f("ngModelChange",function(o){m(e);let d=s();return x(d.producto.tiene_garantia,o)||(d.producto.tiene_garantia=o),u(o)}),i(),t(129,"label",132),n(130," \xBFTiene garant\xEDa? "),i()(),v(131,_e,4,1,"div",134)(132,xe,4,1,"div",134),i()(),t(133,"div",135)(134,"button",136),y("click",function(){m(e);let o=s();return o.mostrarFormulario=!1,o.modoEdicion=!1,u(o.producto=o.getEmptyProducto())}),n(135," Cancelar "),i(),t(136,"button",137),b(),t(137,"svg",28),g(138,"path",138),i(),n(139),i()()()()()()}if(l&2){let e=s();c(7),w(" ",e.modoEdicion?"Editar Producto":"Crear Nuevo Producto"," "),c(16),_("ngModel",e.producto.nombre),c(5),_("ngModel",e.producto.codigo),p("value",e.producto.codigo),c(6),_("ngModel",e.producto.unidad_medida),c(),p("ngForOf",e.unidadesMedida),c(6),_("ngModel",e.producto.id_categoria),c(),p("ngValue",null),c(2),p("ngForOf",e.categorias),c(4),_("ngModel",e.producto.marca),c(4),_("ngModel",e.producto.id_proveedor),c(),p("ngValue",null),c(2),p("ngForOf",e.proveedores),c(13),_("ngModel",e.producto.precio_compra),c(9),_("ngModel",e.producto.precio_unitario),c(9),_("ngModel",e.producto.precio_mayor),c(6),_("ngModel",e.producto.stock_actual),c(),p("ngIf",(e.producto.stock_actual||0)===0),c(5),_("ngModel",e.producto.descripcion),c(10),_("ngModel",e.producto.material),c(4),_("ngModel",e.producto.peso),c(4),_("ngModel",e.producto.medidas),c(8),_("ngModel",e.producto.tiene_caducidad),c(4),_("ngModel",e.producto.tiene_garantia),c(3),p("ngIf",e.producto.tiene_caducidad),c(),p("ngIf",e.producto.tiene_garantia),c(7),w(" ",e.modoEdicion?"Guardar Cambios":"Guardar Producto"," ")}}var oe=class l{constructor(r,e,a,o,d){this.productosService=r;this.categoriasService=e;this.proveedoresService=a;this.comprasService=o;this.notificacionesService=d}productos=[];productosFiltrados=[];categorias=[];proveedores=[];loading=!0;terminoBusqueda="";mostrarFormulario=!1;modoEdicion=!1;producto=this.getEmptyProducto();unidadesMedida=["UND","M","KG","CAJA","L","M2","M3","PAR","SET","ROLLO","BOLSA","LITRO","GALON"];resumenCompras=new Map;ngOnInit(){return E(this,null,function*(){yield this.cargarCategorias(),yield this.cargarProveedores(),yield this.cargarProductos()})}getEmptyProducto(){return{codigo:"",nombre:"",descripcion:"",id_categoria:null,id_proveedor:null,unidad_medida:"UND",stock_actual:0,stock_minimo:0,precio_unitario:0,precio_mayor:null,tiene_caducidad:!1,fecha_vencimiento:null,tiene_garantia:!1,meses_garantia:null,precio_compra:null,marca:null,material:null,peso:null,medidas:null}}cargarCategorias(){return E(this,null,function*(){this.categorias=yield this.categoriasService.getCategorias()})}cargarProveedores(){return E(this,null,function*(){this.proveedores=yield this.proveedoresService.getProveedores()})}cargarProductos(){return E(this,null,function*(){this.loading=!0;try{this.productos=yield this.productosService.getProductos();let r=[];for(let e of this.productos)if(e.stock_actual<0&&(console.warn(`Producto ${e.nombre} tiene stock negativo (${e.stock_actual}). Corrigiendo a 0.`),e.stock_actual=0),e.stock_actual===0&&r.push(e.nombre),e.id_producto)try{let a=yield this.comprasService.getResumenComprasPorProducto(e.id_producto);this.resumenCompras.set(e.id_producto,a)}catch(a){console.error(`Error al cargar resumen de compras para producto ${e.id_producto}:`,a),this.resumenCompras.set(e.id_producto,{cantidad_total:0,precio_unitario_promedio:e.precio_compra||0,precio_total_compra:0})}r.length>0&&r.forEach((e,a)=>{let o=this.productos.find(d=>d.nombre===e);o&&this.notificacionesService.agregarNotificacion({id:`stock-cero-cargar-${o.id_producto||a}`,tipo:"stock_agotado",titulo:"Producto con Stock CERO",mensaje:`El producto "${e}" tiene stock en CERO. No se podr\xE1n realizar ventas hasta que se reponga stock.`,producto:o,fecha:new Date,leida:!1})})}catch(r){console.error("Error al cargar productos:",r)}finally{this.filtrarProductos(),this.loading=!1}})}filtrarProductos(){if(!this.terminoBusqueda.trim())this.productosFiltrados=this.productos;else{let r=this.terminoBusqueda.toLowerCase();this.productosFiltrados=this.productos.filter(e=>e.codigo?.toLowerCase().includes(r)||e.nombre?.toLowerCase().includes(r)||e.descripcion?.toLowerCase().includes(r))}}generarCodigo(){let r="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",e="";for(let a=0;a<10;a++)e+=r.charAt(Math.floor(Math.random()*r.length));return e}nuevoProducto(){this.modoEdicion=!1,this.mostrarFormulario=!this.mostrarFormulario,this.producto=this.getEmptyProducto(),this.modoEdicion||(this.producto.codigo=this.generarCodigo())}editarProducto(r){this.modoEdicion=!0,this.mostrarFormulario=!0,this.producto=P({},r),this.producto.stock_actual<0&&(this.producto.stock_actual=0)}validarStock(){this.producto.stock_actual<0&&(this.producto.stock_actual=0,this.notificacionesService.agregarNotificacion({id:`stock-negativo-${Date.now()}`,tipo:"error",titulo:"Stock Negativo Corregido",mensaje:`El stock de "${this.producto.nombre||"producto"}" no puede ser negativo. Se ha ajustado a 0.`,producto:this.producto,fecha:new Date,leida:!1})),this.producto.stock_actual===0&&this.producto.nombre&&this.notificacionesService.agregarNotificacion({id:`stock-cero-${this.producto.id_producto||Date.now()}`,tipo:"stock_agotado",titulo:"Stock en CERO",mensaje:`El producto "${this.producto.nombre}" tiene stock en CERO. No se podr\xE1n realizar ventas hasta que se reponga stock.`,producto:this.producto,fecha:new Date,leida:!1})}prepararDatosParaSupabase(r){let e=Math.max(0,r.stock_actual||0),a={codigo:r.codigo,nombre:r.nombre,descripcion:r.descripcion||null,id_categoria:r.id_categoria,id_proveedor:r.id_proveedor,unidad_medida:r.unidad_medida,stock_actual:e,stock_minimo:0,precio_unitario:r.precio_unitario,precio_mayor:r.precio_mayor||null,tiene_caducidad:r.tiene_caducidad,fecha_vencimiento:r.fecha_vencimiento||null,tiene_garantia:r.tiene_garantia,meses_garantia:r.meses_garantia||null};return r.precio_compra!==null&&r.precio_compra!==void 0?a.precio_compra=r.precio_compra:a.precio_compra=null,r.marca&&(a.marca=r.marca),a}guardarProducto(){return E(this,null,function*(){try{this.producto.stock_actual<0&&(this.producto.stock_actual=0,this.notificacionesService.agregarNotificacion({id:`stock-negativo-guardar-${Date.now()}`,tipo:"error",titulo:"Stock Negativo Corregido",mensaje:`El stock de "${this.producto.nombre||"producto"}" no puede ser negativo. Se ha ajustado a 0.`,producto:this.producto,fecha:new Date,leida:!1})),this.producto.stock_actual===0&&this.notificacionesService.agregarNotificacion({id:`stock-cero-guardar-${this.producto.id_producto||Date.now()}`,tipo:"stock_agotado",titulo:"Producto con Stock CERO",mensaje:`El producto "${this.producto.nombre}" se guardar\xE1 con stock en CERO. No se podr\xE1n realizar ventas hasta que se reponga stock.`,producto:this.producto,fecha:new Date,leida:!1}),!this.modoEdicion&&(!this.producto.codigo||this.producto.codigo.trim()==="")&&(this.producto.codigo=this.generarCodigo());let r=this.prepararDatosParaSupabase(this.producto);this.modoEdicion&&this.producto.id_producto?(yield this.productosService.updateProducto(this.producto.id_producto,r),this.notificacionesService.agregarNotificacion({id:`producto-actualizado-${Date.now()}`,tipo:"info",titulo:"Producto Actualizado",mensaje:`El producto "${this.producto.nombre}" ha sido actualizado correctamente.`,producto:this.producto,fecha:new Date,leida:!1})):(yield this.productosService.addProducto(r),this.notificacionesService.agregarNotificacion({id:`producto-creado-${Date.now()}`,tipo:"info",titulo:"Producto Creado",mensaje:`El producto "${this.producto.nombre}" ha sido creado correctamente.`,producto:this.producto,fecha:new Date,leida:!1})),this.producto=this.getEmptyProducto(),this.modoEdicion=!1,this.mostrarFormulario=!1,this.cargarProductos()}catch(r){console.error(r),alert("Error al guardar: "+(r instanceof Error?r.message:"Error desconocido"))}})}eliminarProducto(r){return E(this,null,function*(){let e=this.productos.find(o=>o.id_producto===r),a=e?.nombre||"producto";if(confirm(`\xBFDeseas eliminar el producto "${a}"?`))try{yield this.productosService.deleteProducto(r),this.notificacionesService.agregarNotificacion({id:`producto-eliminado-${Date.now()}`,tipo:"info",titulo:"Producto Eliminado",mensaje:`El producto "${a}" ha sido eliminado correctamente.`,producto:e,fecha:new Date,leida:!1}),this.cargarProductos()}catch(o){let d="Error desconocido al eliminar el producto";o?.message&&(o.message.includes("foreign key")||o.message.includes("violates foreign key")||o.message.includes("still referenced")||o.message.includes("constraint")?d=`No se puede eliminar el producto "${a}" porque est\xE1 siendo utilizado en ventas o compras registradas. Para eliminarlo, primero debes eliminar o modificar esos registros en Supabase.`:d=o.message),console.error("Error al eliminar producto:",o),this.notificacionesService.agregarNotificacion({id:`error-eliminar-${Date.now()}`,tipo:"error",titulo:"Error al Eliminar Producto",mensaje:d,producto:e,fecha:new Date,leida:!1})}})}getCategoriaNombre(r){return this.categorias.find(e=>e.id_categoria===r)?.nombre||"-"}getProveedorNombre(r){return this.proveedores.find(e=>e.id_proveedor===r)?.nombre||"-"}getStockActual(r){return Math.max(0,r.stock_actual||0)}getTotalStock(){return this.productos.reduce((r,e)=>r+Math.max(0,e.stock_actual||0),0)}getCapitalInvertido(){return this.productos.reduce((r,e)=>{let a=Math.max(0,e.precio_compra||0),o=Math.max(0,e.stock_actual||0);return r+a*o},0)}getValorVenta(){return this.productos.reduce((r,e)=>{let a=Math.max(0,e.precio_unitario||0),o=Math.max(0,e.stock_actual||0);return r+a*o},0)}getValorTotalProducto(r){return(r.precio_unitario||0)*(r.stock_actual||0)}getResumenCompras(r){return r?this.resumenCompras.get(r)||{cantidad_total:0,precio_unitario_promedio:0,precio_total_compra:0}:{cantidad_total:0,precio_unitario_promedio:0,precio_total_compra:0}}getIngresoComprado(r){let e=this.getResumenCompras(r.id_producto);return e.cantidad_total>0?Math.max(0,e.cantidad_total):Math.max(0,r.stock_actual||0)}getPrecioCompraPromedio(r){let e=this.getResumenCompras(r.id_producto);return e.precio_unitario_promedio>0?Math.max(0,e.precio_unitario_promedio):Math.max(0,r.precio_compra||0)}getTotalCompraHistorica(r){let e=this.getResumenCompras(r.id_producto);if(e.precio_total_compra>0)return Math.max(0,e.precio_total_compra);let a=this.getIngresoComprado(r),o=this.getPrecioCompraPromedio(r);return Math.max(0,a*o)}getTotalVentaNormal(r){let e=Math.max(0,r.precio_unitario||0),a=Math.max(0,r.stock_actual||0);return e*a}getTotalVentaMayor(r){let e=Math.max(0,r.precio_mayor||0),a=Math.max(0,r.stock_actual||0);return e*a}getCostoStockActual(r){let e=this.getPrecioCompraPromedio(r),a=Math.max(0,r.stock_actual||0);return Math.max(0,e*a)}getMargenPotencialNormal(r){let e=this.getTotalVentaNormal(r),a=this.getCostoStockActual(r);return e-a}getMargenPotencialMayor(r){let e=this.getTotalVentaMayor(r),a=this.getCostoStockActual(r);return e-a}static \u0275fac=function(e){return new(e||l)(k(Y),k($),k(ee),k(te),k(Z))};static \u0275cmp=V({type:l,selectors:[["app-productos"]],standalone:!0,features:[W],decls:65,vars:10,consts:[["sinDatos",""],[1,"h-full","overflow-y-auto"],[1,"container","px-3","mx-auto","grid"],[1,"px-6","py-2","border-b","border-gray-200"],[1,"flex","flex-col","md:flex-row","md:items-center","md:justify-between"],[1,"text-xl","md:text-2xl","font-bold","text-gray-800"],[1,"inline-flex","items-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","mr-3","text-blue-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"],[1,"mt-1","text-xs","md:text-sm","text-gray-500"],[1,"mb-4","mt-3"],["id","detalles-productos-container",1,"bg-white","p-4","rounded-lg","shadow-md"],[1,"text-lg","font-bold","text-gray-800","mb-3"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","inline","mr-2","text-blue-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-2","text-xs","md:text-sm"],[1,"p-3","bg-gray-50","rounded-lg","text-center","shadow"],[1,"text-gray-500","block"],["id","total-productos",1,"text-sm","md:text-base","font-bold","text-blue-600"],["id","total-stock",1,"text-sm","md:text-base","font-bold","text-blue-600"],[1,"text-sm","md:text-base","font-bold","text-yellow-600"],[1,"text-xs","mr-1"],[1,"text-sm","md:text-base","font-bold","text-green-600"],[1,"w-full","overflow-hidden","rounded-lg","shadow-xs","mt-3"],[1,"w-full","overflow-x-auto"],[1,"bg-white","rounded-lg","shadow-md","p-2","md:p-4","mb-6"],[1,"flex","items-center","justify-between","py-2","mb-2","border-b","border-gray-200"],[1,"flex","items-center","text-gray-700","text-xs","font-semibold","ml-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"],["class","flex items-center space-x-2",4,"ngIf"],[1,"mb-4"],[1,"flex","items-center","gap-2","text-sm","text-gray-700","font-medium"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],["type","search","placeholder","Buscar por c\xF3digo, nombre o descripci\xF3n...",1,"flex-1","px-3","py-1.5","border","border-gray-300","rounded-lg","text-sm","text-gray-900","bg-white","outline-none","transition-all","focus:border-blue-500","focus:ring-2","focus:ring-blue-200",3,"ngModelChange","ngModel"],[1,"w-full","overflow-x-auto","pb-2"],["class","p-6 text-center text-gray-500",4,"ngIf"],["class","w-full whitespace-no-wrap",4,"ngIf","ngIfElse"],["class","fixed inset-0 z-50 flex items-center justify-center w-full h-full bg-black bg-opacity-50 overflow-y-auto overflow-x-hidden",3,"click",4,"ngIf"],[1,"flex","items-center","space-x-2"],["type","button",1,"flex","items-center","justify-center","p-2","text-xs","bg-blue-600","hover:bg-blue-700","text-white","rounded-lg","shadow-lg","transition-all","duration-200","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:ring-offset-2",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],[1,"p-6","text-center","text-gray-500"],[1,"w-full","whitespace-no-wrap"],[1,"text-xs","font-semibold","tracking-wide","text-left","text-gray-500","uppercase","border-b","border-gray-200","bg-gray-50"],[1,"px-4","py-3"],[1,"px-4","py-3","text-center"],["colspan","4",1,"px-3","py-3","text-center","bg-blue-100"],["colspan","4",1,"px-3","py-3","text-center","bg-orange-100"],[1,"px-3","py-3","text-center"],[1,"px-2","py-2","text-center","bg-blue-50"],[1,"px-2","py-2","text-center","bg-orange-50"],[1,"px-3","py-3"],[1,"bg-white","divide-y","divide-gray-200"],["class","hover:bg-gray-100 transition-colors",4,"ngFor","ngForOf"],[1,"hover:bg-gray-100","transition-colors"],[1,"px-4","py-3","text-xs","text-gray-700"],[1,"text-center"],[1,"text-gray-900","text-xs","font-medium"],["class","text-gray-500 text-[10px] mt-0.5",4,"ngIf"],[1,"text-gray-700","text-xs"],[1,"px-2","py-3","text-center","bg-blue-50"],[1,"text-gray-900","font-semibold","text-xs"],[1,"text-gray-800","font-semibold","text-sm"],[1,"text-gray-800","font-semibold","text-xs"],[1,"text-gray-800","font-bold","text-sm"],[1,"px-2","py-3","text-center","bg-orange-50"],[3,"title"],["class","ml-1 inline-flex items-center","title","Stock agotado",4,"ngIf"],[1,"text-indigo-600","font-bold","text-xs"],[1,"text-blue-600","font-bold","text-sm"],[1,"flex","items-center","justify-center","space-x-1","px-4","py-1"],["type","button","title","Editar",1,"p-2","text-blue-400","rounded-lg","hover:bg-blue-50","border","border-gray-200",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"],["type","button","title","Eliminar",1,"p-2","text-red-400","rounded-lg","hover:bg-red-50","border","border-gray-200",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"],[1,"text-gray-500","text-[10px]","mt-0.5"],["title","Stock agotado",1,"ml-1","inline-flex","items-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-red-500"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"],[1,"py-12","px-6","text-center","text-gray-600"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-12","h-12","mx-auto","mb-4","text-blue-600"],[1,"m-0","mb-2","text-gray-900","font-semibold"],[1,"m-0","mb-6","text-gray-600"],["type","button","class","inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white border border-blue-600 rounded-lg cursor-pointer font-medium text-sm transition-all hover:bg-blue-700 hover:border-blue-700 hover:shadow-md",3,"click",4,"ngIf"],["type","button",1,"inline-flex","items-center","gap-2","px-4","py-2","bg-blue-600","text-white","border","border-blue-600","rounded-lg","cursor-pointer","font-medium","text-sm","transition-all","hover:bg-blue-700","hover:border-blue-700","hover:shadow-md",3,"click"],[1,"fixed","inset-0","z-50","flex","items-center","justify-center","w-full","h-full","bg-black","bg-opacity-50","overflow-y-auto","overflow-x-hidden",3,"click"],[1,"relative","p-4","w-full","max-w-4xl",3,"click"],[1,"relative","bg-white","rounded-lg","shadow","border","border-gray-200"],[1,"flex","items-center","justify-between","p-4","md:p-5","border-b","border-gray-200","rounded-t"],[1,"text-xl","font-semibold","text-gray-900"],["type","button",1,"text-gray-400","bg-transparent","hover:bg-gray-200","hover:text-gray-900","rounded-lg","text-sm","w-8","h-8","ms-auto","inline-flex","justify-center","items-center",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"p-4","md:p-5","space-y-4","max-h-[70vh]","overflow-y-auto",3,"ngSubmit"],[1,"text-sm","font-semibold","text-gray-700","mb-3","flex","items-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","mr-2","text-blue-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"grid","grid-cols-1","gap-4","mb-4"],[1,"block","mb-2","text-sm","font-medium","text-gray-900"],[1,"text-red-500"],["type","text","name","nombre","required","","placeholder","Ej. Martillo de carpintero 16 oz",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","p-2.5",3,"ngModelChange","ngModel"],[1,"grid","grid-cols-2","md:grid-cols-3","gap-2","mb-4"],["type","text","name","codigo","readonly","","title","C\xF3digo generado autom\xE1ticamente",1,"bg-gray-100","border","border-gray-300","text-gray-600","text-sm","rounded-lg","block","w-full","p-2.5","cursor-not-allowed",3,"ngModelChange","ngModel","value"],["name","unidad_medida","required","",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","p-2.5",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["name","id_categoria","required","",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","p-2.5",3,"ngModelChange","ngModel"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["type","text","name","marca","placeholder","Ej. Stanley, Bosch, DeWalt",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","p-2.5",3,"ngModelChange","ngModel"],["name","id_proveedor",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","p-2.5",3,"ngModelChange","ngModel"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-2","mb-4"],[1,"relative"],[1,"absolute","left-3","top-2.5","text-gray-500","text-[10px]"],["type","number","step","0.01","min","0","name","precio_compra","placeholder","0.00",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","pl-8","p-2.5",3,"ngModelChange","ngModel"],["type","number","step","0.01","min","0","name","precio_unitario","required","","placeholder","0.00",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","pl-8","p-2.5",3,"ngModelChange","ngModel"],["type","number","step","0.01","min","0","name","precio_mayor","required","","placeholder","0.00",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","pl-8","p-2.5",3,"ngModelChange","ngModel"],["type","number","name","stock_actual","required","","min","0",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","p-2.5",3,"ngModelChange","blur","input","ngModel"],["class","mt-1 text-xs text-red-600 flex items-center gap-1",4,"ngIf"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-2","mb-4"],[1,"col-span-2"],["name","descripcion","rows","3","placeholder","Descripci\xF3n detallada del producto...",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","p-2.5",3,"ngModelChange","ngModel"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"],["type","text","name","material","placeholder","Ej. Acero, Pl\xE1stico, Madera",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","p-2.5",3,"ngModelChange","ngModel"],["type","number","step","0.01","min","0","name","peso","placeholder","0.00",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","p-2.5",3,"ngModelChange","ngModel"],["type","text","name","medidas","placeholder","Ej. 30x15x10 cm",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","p-2.5",3,"ngModelChange","ngModel"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"flex","items-center","gap-3"],["type","checkbox","name","tiene_caducidad",1,"w-5","h-5","text-blue-600","bg-gray-100","border-gray-300","rounded","focus:ring-blue-500",3,"ngModelChange","ngModel"],[1,"text-sm","text-gray-900","cursor-pointer"],["type","checkbox","name","tiene_garantia",1,"w-5","h-5","text-blue-600","bg-gray-100","border-gray-300","rounded","focus:ring-blue-500",3,"ngModelChange","ngModel"],[4,"ngIf"],[1,"flex","justify-center","pt-4","mb-4","border-t","border-gray-200"],["type","button",1,"px-5","py-2.5","bg-gray-500","hover:bg-gray-600","text-white","font-medium","rounded-lg","text-sm","focus:outline-none","focus:ring-2","focus:ring-gray-500","transition-all","duration-200","mr-3",3,"click"],["type","submit",1,"flex","items-center","px-5","py-2.5","bg-blue-600","hover:bg-blue-700","text-white","font-medium","rounded-lg","text-sm","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:ring-offset-2","transition-all","duration-200"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],[3,"value"],[1,"mt-1","text-xs","text-red-600","flex","items-center","gap-1"],["type","date","name","fecha_vencimiento",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","p-2.5",3,"ngModelChange","ngModel"],["type","number","name","meses_garantia","min","0",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","p-2.5",3,"ngModelChange","ngModel"]],template:function(e,a){if(e&1){let o=C();t(0,"main",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div")(5,"h2",5)(6,"span",6),b(),t(7,"svg",7),g(8,"path",8),i(),n(9," Gesti\xF3n de Productos "),i()(),h(),t(10,"p",9),n(11," Administra y organiza tus productos de ferreter\xEDa "),i()()()(),t(12,"div",10)(13,"div",11)(14,"h3",12),b(),t(15,"svg",13),g(16,"path",14),i(),n(17," Resumen de Productos "),i(),h(),t(18,"div",15)(19,"div",16)(20,"span",17),n(21,"Total de Productos"),i(),t(22,"span",18),n(23),i()(),t(24,"div",16)(25,"span",17),n(26,"Stock Total"),i(),t(27,"span",19),n(28),i()(),t(29,"div",16)(30,"span",17),n(31,"Capital Invertido"),i(),t(32,"span",20)(33,"span",21),n(34,"S/"),i(),n(35),i()(),t(36,"div",16)(37,"span",17),n(38,"Valor Venta"),i(),t(39,"span",22)(40,"span",21),n(41,"S/"),i(),n(42),i()()()()(),t(43,"div",23)(44,"div",24)(45,"div",25)(46,"div",26)(47,"div",27),b(),t(48,"svg",28),g(49,"path",29),i(),h(),t(50,"span"),n(51,"REGISTROS"),i()(),v(52,ie,6,0,"div",30),i(),t(53,"div",31)(54,"label",32),b(),t(55,"svg",33),g(56,"path",34),i(),n(57," Buscar: "),h(),t(58,"input",35),f("ngModelChange",function(M){return m(o),x(a.terminoBusqueda,M)||(a.terminoBusqueda=M),u(M)}),y("ngModelChange",function(){return m(o),u(a.filtrarProductos())}),i()()(),t(59,"div",36),v(60,re,2,0,"div",37)(61,ce,38,1,"table",38)(62,se,11,1,"ng-template",null,0,L),i()()()()()(),v(64,fe,140,27,"div",39)}if(e&2){let o=I(63);c(23),S(a.productos.length),c(5),w(" ",a.getTotalStock()," "),c(7),w(" ",a.getCapitalInvertido().toFixed(2)," "),c(7),w(" ",a.getValorVenta().toFixed(2)," "),c(10),p("ngIf",!a.modoEdicion&&!a.mostrarFormulario),c(6),_("ngModel",a.terminoBusqueda),c(2),p("ngIf",a.loading),c(),p("ngIf",!a.loading&&a.productosFiltrados.length)("ngIfElse",o),c(3),p("ngIf",a.mostrarFormulario||a.modoEdicion)}},dependencies:[j,F,N,X,R,U,J,B,z,D,q,O,A,Q,K,H,G],encapsulation:2})};export{oe as ProductosComponent};
