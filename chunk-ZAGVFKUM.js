import{c as g}from"./chunk-6ZH3RLRT.js";import{a as p}from"./chunk-5T4VIS3M.js";import{O as l,T as c}from"./chunk-V3AN2ELD.js";import{h as a}from"./chunk-FK42CRUA.js";var m=class u{constructor(e,r){this.supabaseService=e;this.router=r}login(e,r){return a(this,null,function*(){let{data:t,error:s}=yield this.supabaseService.client.auth.signInWithPassword({email:e,password:r});if(s)throw s;let i=t.user,{data:o,error:n}=yield this.supabaseService.client.from("usuarios").select("id_rol").eq("id_usuario",i.id).single();if(n||!o)throw new Error("Usuario sin rol asignado.");return localStorage.setItem("session",JSON.stringify(t.session)),localStorage.setItem("token",t.session.access_token),localStorage.setItem("user_id",i.id),localStorage.setItem("rol",o.id_rol.toString()),t.session})}register(e,r,t){return a(this,null,function*(){let{data:s,error:i}=yield this.supabaseService.client.auth.signUp({email:e,password:r});if(i)throw i;let o=s.user;if(!o)throw new Error("No se pudo crear el usuario en auth.");let{error:n}=yield this.supabaseService.client.from("usuarios").insert({id_usuario:o.id,nombre_usuario:t,id_rol:null,nombre:null,apellido:null});if(n)throw n;return s})}registerInternal(e,r){return a(this,null,function*(){let{data:t,error:s}=yield this.supabaseService.client.auth.signUp({email:e,password:r});if(s)throw s;let i=t.user;if(!i)throw new Error("No se pudo crear el usuario en auth.");return{user:i}})}logout(){return a(this,null,function*(){yield this.supabaseService.client.auth.signOut(),localStorage.removeItem("session"),localStorage.removeItem("token"),localStorage.removeItem("user_id"),this.router.navigate(["/"])})}getSession(){let e=localStorage.getItem("session");return e?JSON.parse(e):null}isAuthenticated(){return!!this.getSession()}static \u0275fac=function(r){return new(r||u)(c(p),c(g))};static \u0275prov=l({token:u,factory:u.\u0275fac,providedIn:"root"})};export{m as a};
