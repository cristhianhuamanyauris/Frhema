import{a as q}from"./chunk-ZJ5CSXJS.js";import{c as P,f as z,i as B,j as G,k as $,o as H}from"./chunk-SMCZ5Z56.js";import{a as W}from"./chunk-5T4VIS3M.js";import{$a as V,Cb as A,Db as j,Ga as c,Gb as L,Ia as l,Ka as R,Ma as r,Na as n,O as C,Oa as b,Pa as h,Qa as M,Ra as s,T as E,Va as k,W as U,Wa as i,Xa as T,Ya as m,_a as N,ab as F,ca as _,cb as O,da as y,ea as x,fa as S,ib as D,wa as a,xa as v}from"./chunk-V3AN2ELD.js";import{a as w,b as I,h as u}from"./chunk-FK42CRUA.js";var f=class t{constructor(o){this.supabase=o}TABLE="roles";getRoles(){return u(this,null,function*(){let{data:o,error:e}=yield this.supabase.client.from(this.TABLE).select("*").order("id_rol",{ascending:!0});if(e)throw e;return o})}static \u0275fac=function(e){return new(e||t)(E(W))};static \u0275prov=C({token:t,factory:t.\u0275fac,providedIn:"root"})};function X(t,o){t&1&&(r(0,"div",4),i(1," Cargando usuarios... "),n())}function Y(t,o){t&1&&(r(0,"span",20),i(1," SUPERADMIN (bloqueado) "),n())}function Z(t,o){if(t&1&&(r(0,"span",21),i(1),n()),t&2){let e=s().$implicit;R("bg-blue-100",e.roles==null?null:e.roles.nombre_rol)("text-blue-700",e.roles==null?null:e.roles.nombre_rol)("bg-gray-100",!(e.roles!=null&&e.roles.nombre_rol))("text-gray-700",!(e.roles!=null&&e.roles.nombre_rol)),a(),m(" ",(e.roles==null?null:e.roles.nombre_rol)||"SIN ROL"," ")}}function ee(t,o){if(t&1&&(r(0,"select",22)(1,"option"),i(2),n()()),t&2){let e=s().$implicit;a(2),T(e.roles==null?null:e.roles.nombre_rol)}}function te(t,o){if(t&1&&(r(0,"option",24),i(1),n()),t&2){let e=o.$implicit;l("ngValue",e.id_rol),a(),m(" ",e.nombre_rol," ")}}function re(t,o){if(t&1){let e=h();r(0,"select",23),F("ngModelChange",function(d){_(e);let g=s().$implicit;return V(g.id_rol,d)||(g.id_rol=d),y(d)}),r(1,"option",24),i(2,"SIN ROL"),n(),c(3,te,2,2,"option",25),n()}if(t&2){let e=s().$implicit,p=s(2);N("ngModel",e.id_rol),a(),l("ngValue",null),a(2),l("ngForOf",p.roles)}}function ne(t,o){t&1&&(r(0,"button",26),x(),r(1,"svg",27),b(2,"path",28),n(),i(3," Guardar "),n())}function oe(t,o){if(t&1){let e=h();r(0,"button",29),M("click",function(){_(e);let d=s().$implicit,g=s(2);return y(g.guardarRol(d))}),x(),r(1,"svg",27),b(2,"path",28),n(),S(),r(3,"span"),i(4,"Guardar"),n()()}}function ie(t,o){if(t&1&&(r(0,"tr",9)(1,"td",10),i(2),n(),r(3,"td",11),i(4),n(),r(5,"td",11),i(6),n(),r(7,"td",12),c(8,Y,2,0,"span",13)(9,Z,2,9,"span",14),n(),r(10,"td",12),c(11,ee,3,1,"select",15)(12,re,4,3,"select",16),n(),r(13,"td",12)(14,"div",17),c(15,ne,4,0,"button",18)(16,oe,5,0,"button",19),n()()()),t&2){let e=o.$implicit;a(2),m(" ",e.nombre_usuario," "),a(2),m(" ",e.nombre||"-"," "),a(2),m(" ",e.apellido||"-"," "),a(2),l("ngIf",e.esSuperadmin),a(),l("ngIf",!e.esSuperadmin),a(2),l("ngIf",e.esSuperadmin),a(),l("ngIf",!e.esSuperadmin),a(3),l("ngIf",e.esSuperadmin),a(),l("ngIf",!e.esSuperadmin)}}function ae(t,o){if(t&1&&(r(0,"table",5)(1,"thead")(2,"tr")(3,"th",6),i(4," Usuario "),n(),r(5,"th",6),i(6," Nombre "),n(),r(7,"th",7),i(8," Apellido "),n(),r(9,"th",7),i(10," Rol Actual "),n(),r(11,"th",7),i(12," Asignar Rol "),n(),r(13,"th",7),i(14," Acci\xF3n "),n()()(),r(15,"tbody"),c(16,ie,17,9,"tr",8),n()()),t&2){let e=s();a(16),l("ngForOf",e.usuarios)}}function le(t,o){t&1&&(r(0,"div",30),x(),r(1,"svg",31),b(2,"path",32)(3,"path",33),n(),S(),r(4,"h3",34),i(5," No hay usuarios registrados "),n(),r(6,"p",35),i(7," Los usuarios aparecer\xE1n aqu\xED cuando se registren en el sistema. "),n()())}var J=class t{constructor(o,e){this.usuariosService=o;this.rolesService=e}usuarios=[];roles=[];loading=!0;SUPERADMIN_ID="e3a3f8f6-ded6-45fa-a2e3-5d873e6fab34";ngOnInit(){return u(this,null,function*(){yield this.cargarRoles(),yield this.cargarUsuarios()})}cargarRoles(){return u(this,null,function*(){this.roles=yield this.rolesService.getRoles()})}cargarUsuarios(){return u(this,null,function*(){this.loading=!0;let o=yield this.usuariosService.getUsuarios();this.usuarios=o.map(e=>I(w({},e),{esSuperadmin:e.id_usuario===this.SUPERADMIN_ID})),this.loading=!1})}guardarRol(o){return u(this,null,function*(){if(o.esSuperadmin){alert("\u26A0\uFE0F El superadmin no puede cambiar de rol.");return}try{yield this.usuariosService.actualizarRolUsuario(o.id_usuario,o.id_rol??null),alert("Rol actualizado correctamente");let e=localStorage.getItem("user_id");e&&e===o.id_usuario&&console.warn("Has cambiado tu propio rol. Vuelve a iniciar sesi\xF3n para aplicar cambios.")}catch(e){console.error(e),alert("Error al actualizar rol")}})}static \u0275fac=function(e){return new(e||t)(v(q),v(f))};static \u0275cmp=U({type:t,selectors:[["app-usuarios"]],standalone:!0,features:[O],decls:5,vars:3,consts:[["sinDatos",""],[1,"rounded-none","border-none","bg-transparent","overflow-auto","shadow-none","px-0","pb-2"],["class","p-6 text-center text-gray-500",4,"ngIf"],["class","w-full border-collapse min-w-[960px]",4,"ngIf","ngIfElse"],[1,"p-6","text-center","text-gray-500"],[1,"w-full","border-collapse","min-w-[960px]"],[1,"text-left","text-xs","tracking-wider","uppercase","text-gray-600","py-3.5","px-4","bg-transparent","sticky","top-0","border-b","border-gray-200","font-semibold"],[1,"text-left","text-xs","tracking-wider","uppercase","text-gray-600","py-3.5","px-4","bg-transparent","sticky","top-0","border-gray-200","font-semibold"],["class","hover:bg-blue-50 transition-colors",4,"ngFor","ngForOf"],[1,"hover:bg-blue-50","transition-colors"],[1,"py-4","px-4","border-b","border-gray-100","align-middle","text-gray-900","text-sm","font-semibold"],[1,"py-4","px-4","border-b","border-gray-100","align-middle","text-gray-900","text-sm"],[1,"py-4","px-4","border-b","border-gray-100","align-middle"],["class","px-2 py-1 rounded-full text-xs font-semibold bg-purple-100 text-purple-700",4,"ngIf"],["class","px-2 py-1 rounded-full text-xs font-medium",3,"bg-blue-100","text-blue-700","bg-gray-100","text-gray-700",4,"ngIf"],["disabled","","class","px-3 py-2 rounded-lg border border-gray-300 bg-gray-100 text-gray-500 text-sm cursor-not-allowed",4,"ngIf"],["class",`px-3 py-2 rounded-lg border border-gray-300 bg-gray-50 text-gray-900 outline-none text-sm 
                   transition-all focus:border-blue-600 focus:bg-white focus:ring-1 focus:ring-blue-200 
                   hover:border-gray-400`,3,"ngModel","ngModelChange",4,"ngIf"],[1,"flex","gap-2.5","justify-end"],["disabled","","class",`border border-gray-200 bg-gray-100 text-gray-400 rounded-lg px-3.5 py-2 
                     text-xs font-medium cursor-not-allowed flex items-center gap-2`,4,"ngIf"],["class",`border border-gray-300 bg-white text-gray-900 rounded-lg px-3.5 py-2 cursor-pointer 
                     inline-flex items-center gap-2 transition-all 
                     hover:-translate-y-0.5 hover:bg-gray-50 hover:border-gray-400 hover:shadow 
                     text-xs font-medium whitespace-nowrap`,3,"click",4,"ngIf"],[1,"px-2","py-1","rounded-full","text-xs","font-semibold","bg-purple-100","text-purple-700"],[1,"px-2","py-1","rounded-full","text-xs","font-medium"],["disabled","",1,"px-3","py-2","rounded-lg","border","border-gray-300","bg-gray-100","text-gray-500","text-sm","cursor-not-allowed"],[1,"px-3","py-2","rounded-lg","border","border-gray-300","bg-gray-50","text-gray-900","outline-none","text-sm","transition-all","focus:border-blue-600","focus:bg-white","focus:ring-1","focus:ring-blue-200","hover:border-gray-400",3,"ngModelChange","ngModel"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["disabled","",1,"border","border-gray-200","bg-gray-100","text-gray-400","rounded-lg","px-3.5","py-2","text-xs","font-medium","cursor-not-allowed","flex","items-center","gap-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-3.5","h-3.5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],[1,"border","border-gray-300","bg-white","text-gray-900","rounded-lg","px-3.5","py-2","cursor-pointer","inline-flex","items-center","gap-2","transition-all","hover:-translate-y-0.5","hover:bg-gray-50","hover:border-gray-400","hover:shadow","text-xs","font-medium","whitespace-nowrap",3,"click"],[1,"py-12","px-6","text-center","text-gray-600"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-12","h-12","mx-auto","mb-4","text-blue-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d",`M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 
             3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 
             0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 
             2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 
             1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826 
             -2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 
             0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 
             2.37-2.37.996.608 2.296.07 2.572-1.065z`],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 12a3 3 0 11-6 0 3 3 0 016 0z"],[1,"m-0","mb-2","text-gray-900","font-semibold"],[1,"m-0","text-gray-600"]],template:function(e,p){if(e&1&&(r(0,"section",1),c(1,X,2,0,"div",2)(2,ae,17,1,"table",3)(3,le,8,0,"ng-template",null,0,D),n()),e&2){let d=k(4);a(),l("ngIf",p.loading),a(),l("ngIf",!p.loading&&p.usuarios.length)("ngIfElse",d)}},dependencies:[L,A,j,H,G,$,B,P,z],encapsulation:2})};export{J as UsuariosComponent};
