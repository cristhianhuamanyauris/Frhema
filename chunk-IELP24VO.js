import{a as f}from"./chunk-KKIOE5AM.js";import{O as r,T as n,f as s}from"./chunk-V3AN2ELD.js";import{h as e}from"./chunk-FK42CRUA.js";var d=class c{constructor(o){this.productosService=o;this.cargarNotificacionesStock(),setInterval(()=>this.cargarNotificacionesStock(),5*60*1e3)}notificaciones=[];notificacionesSubject=new s([]);notificaciones$=this.notificacionesSubject.asObservable();cargarNotificacionesStock(){return e(this,null,function*(){try{let o=yield this.productosService.getProductosStockCritico();this.notificaciones=this.notificaciones.filter(i=>i.tipo!=="stock_critico"&&i.tipo!=="stock_agotado"||i.leida),o.forEach(i=>{let t=i.stock_actual||0,a=i.stock_minimo||0,h=t===0?"stock_agotado":"stock_critico",l=t===0?"Producto Agotado":"Stock Cr\xEDtico",u=t===0?`${i.nombre} se ha agotado. Stock: ${t}`:`${i.nombre} tiene stock bajo. Stock actual: ${t}${a>0?` (M\xEDnimo: ${a})`:""}`;this.agregarNotificacion({id:`stock-${i.id_producto}`,tipo:h,titulo:l,mensaje:u,producto:i,fecha:new Date,leida:!1})}),this.actualizarNotificaciones()}catch(o){console.error("Error al cargar notificaciones de stock:",o)}})}agregarNotificacion(o){this.notificaciones.some(t=>t.producto?.id_producto===o.producto?.id_producto&&t.tipo===o.tipo&&!t.leida)||(this.notificaciones.unshift(o),this.notificaciones.length>50&&(this.notificaciones=this.notificaciones.slice(0,50)),this.actualizarNotificaciones())}getNotificacionesNoLeidas(){return this.notificaciones.filter(o=>!o.leida)}getCantidadNoLeidas(){return this.getNotificacionesNoLeidas().length}marcarComoLeida(o){let i=this.notificaciones.find(t=>t.id===o);i&&(i.leida=!0,this.actualizarNotificaciones())}marcarTodasComoLeidas(){this.notificaciones.forEach(o=>o.leida=!0),this.actualizarNotificaciones()}eliminarNotificacion(o){this.notificaciones=this.notificaciones.filter(i=>i.id!==o),this.actualizarNotificaciones()}getNotificaciones(){return this.notificaciones}actualizarNotificaciones(){this.notificacionesSubject.next([...this.notificaciones])}static \u0275fac=function(i){return new(i||c)(n(f))};static \u0275prov=r({token:c,factory:c.\u0275fac,providedIn:"root"})};export{d as a};
