import{a as P}from"./chunk-MPLFMEUX.js";import"./chunk-5T4VIS3M.js";import{Bb as h,Cb as S,Db as C,Ga as m,Gb as E,Ia as l,Ja as x,Ma as i,Na as e,Oa as v,Ra as p,W as g,Wa as n,Xa as f,Ya as s,cb as y,eb as b,wa as d,xa as u}from"./chunk-V3AN2ELD.js";import{h as c}from"./chunk-FK42CRUA.js";var I=(r,t)=>({"bg-yellow-100 text-yellow-700":r,"bg-gray-100 text-gray-600":t});function M(r,t){if(r&1&&(i(0,"div",22),n(1),e()),r&2){let o=p();d(),s(" ",o.errorMessage," ")}}function T(r,t){r&1&&(i(0,"div",23),n(1," Cargando informaci\xF3n de productos... "),e())}function w(r,t){r&1&&(i(0,"div",23),n(1," A\xFAn no hay ventas registradas para calcular este ranking. "),e())}function F(r,t){if(r&1&&(i(0,"tr",30)(1,"td",31)(2,"div",32)(3,"span",33),n(4),e(),i(5,"span",34),n(6),e()()(),i(7,"td",35),n(8),e()()),r&2){let o=t.$implicit,a=t.index;d(3),l("ngClass",b(4,I,a===0,a!==0)),d(),s(" ",a+1," "),d(2),f(o.nombre),d(2),s(" ",o.cantidad_total," ")}}function k(r,t){if(r&1&&(i(0,"div",24)(1,"table",25)(2,"thead")(3,"tr",26)(4,"th",27),n(5,"Producto"),e(),i(6,"th",28),n(7,"Cantidad"),e()()(),i(8,"tbody"),m(9,F,9,7,"tr",29),e()()()),r&2){let o=p();d(9),l("ngForOf",o.topProductos)}}function G(r,t){r&1&&(i(0,"div",23),n(1," Cargando ventas por categor\xEDa... "),e())}function N(r,t){r&1&&(i(0,"div",23),n(1," No hay datos suficientes para mostrar esta distribuci\xF3n. "),e())}function D(r,t){if(r&1&&(i(0,"div",38)(1,"div",39)(2,"span",40),n(3),e(),i(4,"span",41),n(5),e()(),i(6,"div",42),v(7,"div",43),e()()),r&2){let o=t.$implicit,a=p(2);d(3),s(" ",o.categoria," "),d(2),s(" ",a.formatearMoneda(o.total)," "),d(2),x("width",a.getPorcentajeCategoria(o.total),"%")}}function K(r,t){if(r&1&&(i(0,"div",36),m(1,D,8,4,"div",37),e()),r&2){let o=p();d(),l("ngForOf",o.ventasPorCategoria)}}var _=class r{constructor(t){this.reportesService=t}loadingKPIs=!0;loadingTopProductos=!0;loadingCategorias=!0;errorMessage="";kpis={ventasHoy:0,ventasMes:0,ventasAnio:0,comprasMes:0,ticketPromedio:0};topProductos=[];ventasPorCategoria=[];ngOnInit(){return c(this,null,function*(){yield Promise.all([this.cargarKPIs(),this.cargarTopProductos(),this.cargarVentasPorCategoria()])})}cargarKPIs(){return c(this,null,function*(){this.loadingKPIs=!0,this.errorMessage="";try{let t=yield this.reportesService.getKPIs();this.kpis={ventasHoy:Number(t.ventasHoy)||0,ventasMes:Number(t.ventasMes)||0,ventasAnio:Number(t.ventasAnio)||0,comprasMes:Number(t.comprasMes)||0,ticketPromedio:Number(t.ticketPromedio)||0}}catch(t){console.error(t),this.errorMessage="Error al cargar KPIs gerenciales."}finally{this.loadingKPIs=!1}})}cargarTopProductos(){return c(this,null,function*(){this.loadingTopProductos=!0;try{let t=yield this.reportesService.getTopProductos(10);this.topProductos=(t||[]).map(o=>({nombre:o.nombre,cantidad_total:Number(o.cantidad_total)||0}))}catch(t){console.error(t)}finally{this.loadingTopProductos=!1}})}cargarVentasPorCategoria(){return c(this,null,function*(){this.loadingCategorias=!0;try{let t=yield this.reportesService.getVentasPorCategoria();this.ventasPorCategoria=(t||[]).map(o=>({categoria:o.categoria||"Sin categor\xEDa",total:Number(o.total)||0}))}catch(t){console.error(t)}finally{this.loadingCategorias=!1}})}formatearMoneda(t){return t?`S/ ${t.toFixed(2)}`:"S/ 0.00"}getMaxTotalCategorias(){return this.ventasPorCategoria.length?Math.max(...this.ventasPorCategoria.map(t=>t.total)):0}getPorcentajeCategoria(t){let o=this.getMaxTotalCategorias();return o?t/o*100:0}static \u0275fac=function(o){return new(o||r)(u(P))};static \u0275cmp=g({type:r,selectors:[["app-gerencial"]],standalone:!0,features:[y],decls:68,vars:12,consts:[[1,"p-4","md:p-6","space-y-6"],[1,"flex","flex-col","md:flex-row","md:items-center","md:justify-between","gap-2"],[1,"text-2xl","font-semibold","text-gray-900","tracking-tight"],[1,"text-sm","text-gray-600","mt-1"],["class","p-3 rounded-md bg-red-50 border border-red-200 text-sm text-red-700",4,"ngIf"],[1,"text-sm","font-semibold","text-gray-700","mb-2","uppercase","tracking-wide"],[1,"grid","grid-cols-1","sm:grid-cols-2","lg:grid-cols-5","gap-3"],[1,"bg-white","border","border-gray-200","rounded-xl","shadow-sm","p-4","flex","flex-col"],[1,"text-xs","font-medium","text-gray-500","uppercase"],[1,"text-xl","font-bold","text-gray-900","mt-2"],[1,"text-[11px]","text-gray-500","mt-1"],[1,"text-xl","font-bold","text-blue-700","mt-2"],[1,"text-xl","font-bold","text-emerald-700","mt-2"],[1,"text-xl","font-bold","text-orange-600","mt-2"],[1,"text-xl","font-bold","text-purple-700","mt-2"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-4"],[1,"flex","items-center","justify-between","mb-3"],[1,"text-sm","font-semibold","text-gray-800","uppercase","tracking-wide"],[1,"text-xs","text-gray-500"],["class","text-sm text-gray-500",4,"ngIf"],["class","overflow-x-auto",4,"ngIf"],["class","space-y-2",4,"ngIf"],[1,"p-3","rounded-md","bg-red-50","border","border-red-200","text-sm","text-red-700"],[1,"text-sm","text-gray-500"],[1,"overflow-x-auto"],[1,"min-w-full","text-sm"],[1,"text-xs","uppercase","text-gray-500","border-b","border-gray-200"],[1,"py-2","pr-2","text-left"],[1,"py-2","px-2","text-right"],["class","border-b border-gray-100 hover:bg-gray-50 transition-colors",4,"ngFor","ngForOf"],[1,"border-b","border-gray-100","hover:bg-gray-50","transition-colors"],[1,"py-2","pr-2"],[1,"flex","items-center","gap-2"],[1,"inline-flex","items-center","justify-center","w-5","h-5","text-[10px]","font-semibold","rounded-full",3,"ngClass"],[1,"text-gray-800","font-medium"],[1,"py-2","px-2","text-right","font-semibold","text-blue-700"],[1,"space-y-2"],["class","space-y-1",4,"ngFor","ngForOf"],[1,"space-y-1"],[1,"flex","items-center","justify-between","text-xs"],[1,"font-medium","text-gray-800"],[1,"text-gray-600","font-semibold"],[1,"w-full","bg-gray-100","rounded-full","h-2","overflow-hidden"],[1,"h-2","rounded-full","bg-gradient-to-r","from-blue-500","to-blue-300"]],template:function(o,a){o&1&&(i(0,"div",0)(1,"div",1)(2,"div")(3,"h1",2),n(4," Reporte Gerencial "),e(),i(5,"p",3),n(6," Visi\xF3n general del desempe\xF1o de la ferreter\xEDa: ventas, compras y productos clave. "),e()()(),m(7,M,2,1,"div",4),i(8,"section")(9,"h2",5),n(10," Indicadores clave "),e(),i(11,"div",6)(12,"div",7)(13,"p",8),n(14,"Ventas Hoy"),e(),i(15,"h3",9),n(16),e(),i(17,"p",10),n(18," Total vendido en el d\xEDa actual. "),e()(),i(19,"div",7)(20,"p",8),n(21,"Ventas del Mes"),e(),i(22,"h3",11),n(23),e(),i(24,"p",10),n(25," Suma de todas las ventas del mes actual. "),e()(),i(26,"div",7)(27,"p",8),n(28,"Ventas del A\xF1o"),e(),i(29,"h3",12),n(30),e(),i(31,"p",10),n(32," Total acumulado en el a\xF1o calendario. "),e()(),i(33,"div",7)(34,"p",8),n(35,"Compras del Mes"),e(),i(36,"h3",13),n(37),e(),i(38,"p",10),n(39," Monto invertido en reposici\xF3n de stock. "),e()(),i(40,"div",7)(41,"p",8),n(42,"Ticket Promedio"),e(),i(43,"h3",14),n(44),e(),i(45,"p",10),n(46," Promedio por venta en el mes. "),e()()()(),i(47,"section",15)(48,"div",7)(49,"div",16)(50,"div")(51,"h2",17),n(52," Top productos m\xE1s vendidos "),e(),i(53,"p",18),n(54," Ordenados por cantidad vendida (acumulado hist\xF3rico). "),e()()(),m(55,T,2,0,"div",19)(56,w,2,0,"div",19)(57,k,10,1,"div",20),e(),i(58,"div",7)(59,"div",16)(60,"div")(61,"h2",17),n(62," Ventas por categor\xEDa "),e(),i(63,"p",18),n(64," Distribuci\xF3n del total vendido por l\xEDnea de producto. "),e()()(),m(65,G,2,0,"div",19)(66,N,2,0,"div",19)(67,K,2,1,"div",21),e()()()),o&2&&(d(7),l("ngIf",a.errorMessage),d(9),s(" ",a.formatearMoneda(a.kpis.ventasHoy)," "),d(7),s(" ",a.formatearMoneda(a.kpis.ventasMes)," "),d(7),s(" ",a.formatearMoneda(a.kpis.ventasAnio)," "),d(7),s(" ",a.formatearMoneda(a.kpis.comprasMes)," "),d(7),s(" ",a.formatearMoneda(a.kpis.ticketPromedio)," "),d(11),l("ngIf",a.loadingTopProductos),d(),l("ngIf",!a.loadingTopProductos&&a.topProductos.length===0),d(),l("ngIf",!a.loadingTopProductos&&a.topProductos.length>0),d(8),l("ngIf",a.loadingCategorias),d(),l("ngIf",!a.loadingCategorias&&a.ventasPorCategoria.length===0),d(),l("ngIf",!a.loadingCategorias&&a.ventasPorCategoria.length>0))},dependencies:[E,h,S,C]})};export{_ as GerencialComponent};
