import{c as g}from"./chunk-6ZH3RLRT.js";import{a as m}from"./chunk-5T4VIS3M.js";import{O as l,T as c}from"./chunk-V3AN2ELD.js";import{h as n}from"./chunk-FK42CRUA.js";var p=class u{constructor(e,r){this.supabaseService=e;this.router=r}login(e,r){return n(this,null,function*(){let{data:t,error:i}=yield this.supabaseService.client.auth.signInWithPassword({email:e,password:r});if(i)throw i;let s=t.user,{data:o,error:a}=yield this.supabaseService.client.from("usuarios").select("id_rol").eq("id_usuario",s.id).single();if(a||!o)throw new Error("Usuario sin rol asignado.");return localStorage.setItem("session",JSON.stringify(t.session)),localStorage.setItem("token",t.session.access_token),localStorage.setItem("user_id",s.id),localStorage.setItem("rol",o.id_rol.toString()),t.session})}register(e,r,t){return n(this,null,function*(){let{data:i,error:s}=yield this.supabaseService.client.auth.signUp({email:e,password:r});if(s)throw s;let o=i.user;if(!o)throw new Error("No se pudo crear el usuario en auth.");let{error:a}=yield this.supabaseService.client.from("usuarios").insert({id_usuario:o.id,nombre_usuario:t,id_rol:null,nombre:null,apellido:null});if(a)throw a;return i})}logout(){return n(this,null,function*(){yield this.supabaseService.client.auth.signOut(),localStorage.removeItem("session"),localStorage.removeItem("token"),localStorage.removeItem("user_id"),this.router.navigate(["/"])})}getSession(){let e=localStorage.getItem("session");return e?JSON.parse(e):null}isAuthenticated(){return!!this.getSession()}static \u0275fac=function(r){return new(r||u)(c(m),c(g))};static \u0275prov=l({token:u,factory:u.\u0275fac,providedIn:"root"})};export{p as a};
