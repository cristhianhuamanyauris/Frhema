import{a as q,b as J}from"./chunk-WMIZ32TX.js";import{a as K}from"./chunk-6GPENY6S.js";import{a as Y}from"./chunk-BZOVWDEM.js";import{a as U}from"./chunk-KKIOE5AM.js";import{b as A,c as B,f as G,h as O,i as L,j,k as R,l as H,n as z}from"./chunk-WG5PEN7D.js";import"./chunk-5T4VIS3M.js";import{$a as _,Cb as N,Db as W,Ga as v,Gb as D,Ia as u,Ma as e,Na as t,Oa as S,Pa as P,Qa as x,Ra as E,Va as T,W as M,Wa as i,Xa as V,Ya as g,Za as I,_a as b,ab as f,ca as c,cb as k,da as p,ea as h,fa as y,ib as F,wa as l,xa as w}from"./chunk-V3AN2ELD.js";import{h as C}from"./chunk-FK42CRUA.js";function X(m,r){if(m&1&&(e(0,"option",17),i(1),t()),m&2){let o=r.$implicit;u("value",o.id_cliente),l(),g(" ",o.nombre," ")}}function Z(m,r){if(m&1&&(e(0,"option",17),i(1),t()),m&2){let o=r.$implicit;u("value",o.id_producto),l(),I(" ",o.nombre," \u2013 S/. ",o.precio_unitario," ")}}function $(m,r){if(m&1){let o=P();e(0,"tr",57)(1,"td",58),i(2),t(),e(3,"td",58),i(4),t(),e(5,"td",58),i(6),t(),e(7,"td",58),i(8),t(),e(9,"td",58),i(10),t(),e(11,"td",58)(12,"button",59),x("click",function(){let d=c(o).index,s=E(2);return p(s.eliminar(d))}),i(13," Eliminar "),t()()()}if(m&2){let o=r.$implicit,n=E(2);l(2),V(n.getNombreProducto(o.id_producto)),l(2),V(o.cantidad),l(2),g("S/. ",o.precio_unitario,""),l(2),g("S/. ",o.descuento||0,""),l(2),g("S/. ",o.subtotal,"")}}function ee(m,r){if(m&1&&(e(0,"table",54)(1,"thead")(2,"tr")(3,"th",55),i(4,"Producto"),t(),e(5,"th",55),i(6,"Cant."),t(),e(7,"th",55),i(8,"Precio"),t(),e(9,"th",55),i(10,"Desc."),t(),e(11,"th",55),i(12,"Subtotal"),t(),e(13,"th",55),i(14,"Acciones"),t()()(),e(15,"tbody"),v(16,$,14,5,"tr",56),t()()),m&2){let o=E();l(16),u("ngForOf",o.carrito)}}function te(m,r){m&1&&(e(0,"div",60)(1,"h3",61),i(2,"Carrito vac\xEDo"),t(),e(3,"p"),i(4,"Agrega productos para comenzar la venta."),t()())}function ie(m,r){m&1&&(e(0,"div",62),i(1," No se puede aplicar IGV cuando el comprobante es "),e(2,"strong"),i(3,'"No desea"'),t(),i(4,". "),t())}var Q=class m{constructor(r,o,n){this.ventasService=r;this.clientesService=o;this.productosService=n}clientes=[];productos=[];aplicarIgv=!1;incluirIGV=!1;igv=0;base_imponible=0;total_con_igv=0;venta={id_usuario:"",id_cliente:0,tipo_comprobante:"Boleta",nro_comprobante:"",metodo_pago:"Efectivo",total:0,base_imponible:0,igv:0};carrito=[];formProducto={id_producto:0,cantidad:1,descuento:0};ngOnInit(){return C(this,null,function*(){let r=localStorage.getItem("user_id");if(!r){alert("Sesi\xF3n expirada. Inicie sesi\xF3n nuevamente."),window.location.href="/";return}this.venta.id_usuario=r,this.clientes=yield this.clientesService.getClientes(),this.productos=yield this.productosService.getProductos()})}getNombreProducto(r){let o=this.productos.find(n=>n.id_producto===r);return o?o.nombre:"---"}agregarProducto(){let r=this.productos.find(d=>d.id_producto==this.formProducto.id_producto);if(!r){alert("Seleccione un producto");return}if(this.formProducto.cantidad<=0){alert("La cantidad debe ser mayor a 0");return}let o=r.precio_unitario,n={id_producto:r.id_producto,cantidad:this.formProducto.cantidad,precio_unitario:o,descuento:this.formProducto.descuento,subtotal:o*this.formProducto.cantidad-this.formProducto.descuento};this.carrito.push(n),this.formProducto={id_producto:0,cantidad:1,descuento:0},this.calcularTotal()}eliminar(r){this.carrito.splice(r,1),this.calcularTotal()}calcularTotal(){let r=this.carrito.reduce((o,n)=>o+(n.subtotal??0),0);this.incluirIGV?(this.base_imponible=r/1.18,this.igv=r-this.base_imponible,this.total_con_igv=r,this.venta.total=this.total_con_igv):(this.base_imponible=r,this.igv=0,this.total_con_igv=r,this.venta.total=r)}limpiarVenta(){this.carrito=[],this.venta.total=0,this.venta.base_imponible=0,this.venta.igv=0,this.venta.id_cliente=0,this.venta.tipo_comprobante="Boleta",this.venta.metodo_pago="Efectivo",this.venta.nro_comprobante="",this.formProducto={id_producto:0,cantidad:1,descuento:0},this.aplicarIgv=!1}procesarVenta(){return C(this,null,function*(){if(!this.venta.id_cliente||this.venta.id_cliente===0){alert("Seleccione cliente");return}if(this.carrito.length===0){alert("Agregue productos");return}try{let r=yield this.ventasService.registrarVenta(this.venta,this.carrito);alert(`Venta procesada correctamente (#${r})`),this.limpiarVenta()}catch(r){console.error(r),alert("Error al procesar venta. Revisa la consola.")}})}generarComprobantePDF(){if(this.venta.tipo_comprobante==="No desea"){alert("No se generar\xE1 comprobante.");return}let r=this.clientes.find(s=>Number(s.id_cliente)===Number(this.venta.id_cliente)),o=new q({orientation:"portrait",unit:"mm",format:[80,200]});o.setFontSize(10),o.text("FERRETER\xCDA RHEMA",40,10,{align:"center"}),o.text("RUC: 12345678901",40,15,{align:"center"}),o.text("----------------------------------------",2,20),o.text(`Comprobante: ${this.venta.tipo_comprobante}`,2,26),o.text(`N\xFAmero: ${this.venta.nro_comprobante||"---"}`,2,31),o.text(`Cliente: ${r?.nombre||"No seleccionado"}`,2,36),o.text("----------------------------------------",2,42),J(o,{startY:45,head:[["Prod","Cant","P.Unit","Sub"]],body:this.carrito.map(s=>[this.getNombreProducto(s.id_producto),s.cantidad.toString(),"S/ "+s.precio_unitario.toFixed(2),"S/ "+(s.subtotal??0).toFixed(2)]),theme:"plain",styles:{fontSize:8}});let n=o.lastAutoTable.finalY+5;o.text("----------------------------------------",2,n),n+=5,o.setFontSize(12),o.text(`TOTAL: S/ ${this.venta.total.toFixed(2)}`,2,n);let d=`${this.venta.tipo_comprobante}-${Date.now()}.pdf`;o.save(d)}static \u0275fac=function(o){return new(o||m)(w(Y),w(K),w(U))};static \u0275cmp=M({type:m,selectors:[["app-pos"]],standalone:!0,features:[k],decls:133,vars:21,consts:[["sinCarrito",""],[1,"w-full","max-w-[1200px]","mx-auto","flex","flex-col","px-2","md:px-3","pb-2"],[1,"flex","items-start","justify-between","gap-4","px-0","py-3","pb-2","bg-transparent","border-none","shadow-none"],[1,"flex-1"],[1,"flex","items-center","gap-3"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-blue-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"],[1,"m-0","text-2xl","font-semibold","text-gray-900","tracking-wide"],[1,"mt-1","mb-0","text-sm","text-gray-600"],[1,"flex","items-center","justify-between","px-0","py-1.5","mb-1.5","border-b","border-gray-200"],[1,"flex","items-center","text-gray-900","text-xs","font-semibold","uppercase","gap-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-gray-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"],[1,"px-0","pb-3"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-4","gap-3"],[1,"block","mb-2","text-gray-900","text-sm","font-medium","leading-6"],["name","id_cliente",1,"w-full","px-3","py-2.5","rounded-lg","border","border-gray-300","bg-gray-50","text-gray-900",3,"ngModelChange","ngModel"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["name","tipo_comprobante",1,"w-full","px-3","py-2.5","rounded-lg","border","border-gray-300","bg-gray-50","text-gray-900",3,"ngModelChange","ngModel"],["type","text","name","nro_comprobante","placeholder","Ej: B001-000123",1,"w-full","px-3","py-2.5","rounded-lg","border","border-gray-300","bg-gray-50","text-gray-900",3,"ngModelChange","ngModel"],["name","metodo_pago",1,"w-full","px-3","py-2.5","rounded-lg","border","border-gray-300","bg-gray-50","text-gray-900",3,"ngModelChange","ngModel"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],[1,"flex","flex-col","w-full","p-3","border","border-gray-200","rounded-lg","bg-white"],[1,"grid","grid-cols-12","gap-2","mb-1","text-xs","font-semibold","text-gray-600","px-1"],[1,"col-span-6"],[1,"col-span-2","text-center"],[1,"col-span-2"],[1,"grid","grid-cols-12","gap-2"],[1,"form-select","w-full",3,"ngModelChange","ngModel"],["value","0"],["type","number","min","1",1,"form-input","w-full","text-center",3,"ngModelChange","ngModel"],["type","number","min","0","step","0.1",1,"form-input","w-full","text-center",3,"ngModelChange","ngModel"],[1,"col-span-2","flex","items-center"],[1,"btn-primary","w-full","flex","items-center","justify-center","gap-2",3,"click"],[1,"text-right"],[1,"text-xs","text-gray-600"],[1,"text-lg","font-semibold","text-orange-600"],[1,"rounded-none","border-none","bg-transparent","overflow-auto","shadow-none","px-0","pb-2"],["class","w-full border-collapse min-w-[860px]",4,"ngIf","ngIfElse"],[1,"w-full","md:w-96","ml-auto","mt-4","p-4","rounded-lg","border","border-gray-200","bg-white","shadow-sm"],[1,"mb-3"],[1,"block","text-sm","font-medium","text-gray-700"],[1,"mt-1","w-full","px-3","py-2","border","rounded-lg","bg-gray-50",3,"ngModelChange","change","ngModel"],[3,"ngValue"],["class","mt-2 p-2 bg-red-50 text-red-700 border border-red-300 rounded-lg text-xs",4,"ngIf"],[1,"space-y-2","pt-2","border-t","border-gray-200"],[1,"flex","justify-between","text-sm","text-gray-600"],[1,"flex","justify-between","text-lg","font-semibold","text-gray-900","pt-2","border-t"],[1,"text-orange-600"],[1,"flex","justify-end","gap-2","mt-3"],[1,"px-4","py-2","bg-white","border","border-gray-300","rounded-lg",3,"click"],[1,"px-6","py-2.5","bg-orange-600","text-white","rounded-lg",3,"click"],[1,"bg-blue-500","text-white","px-4","py-2","rounded",3,"click","disabled"],[1,"w-full","border-collapse","min-w-[860px]"],[1,"text-left","text-xs","uppercase","text-gray-600","py-3.5","px-4","border-b"],["class","hover:bg-blue-50 transition",4,"ngFor","ngForOf"],[1,"hover:bg-blue-50","transition"],[1,"py-4","px-4","border-b"],["type","button",1,"border","border-red-300","bg-red-50","text-red-700","rounded-lg","px-3","py-2","text-xs",3,"click"],[1,"py-10","px-6","text-center","text-gray-600","border","border-dashed","border-gray-300","rounded-lg","bg-white"],[1,"m-0","mb-2","text-gray-900","font-semibold"],[1,"mt-2","p-2","bg-red-50","text-red-700","border","border-red-300","rounded-lg","text-xs"]],template:function(o,n){if(o&1){let d=P();e(0,"div",1)(1,"header",2)(2,"div",3)(3,"div",4),h(),e(4,"svg",5),S(5,"path",6),t(),y(),e(6,"div")(7,"h1",7),i(8,"Punto de Venta (POS)"),t(),e(9,"p",8),i(10,"Procesa ventas r\xE1pidas y genera comprobantes de pago."),t()()()()(),e(11,"div",9)(12,"div",10),h(),e(13,"svg",11),S(14,"path",12),t(),y(),e(15,"span"),i(16,"DATOS DE VENTA"),t()()(),e(17,"section",13)(18,"div",14)(19,"div")(20,"label",15),i(21,"Cliente"),t(),e(22,"select",16),f("ngModelChange",function(a){return c(d),_(n.venta.id_cliente,a)||(n.venta.id_cliente=a),p(a)}),e(23,"option",17),i(24,"Seleccione cliente"),t(),v(25,X,2,2,"option",18),t()(),e(26,"div")(27,"label",15),i(28,"Comprobante"),t(),e(29,"select",19),f("ngModelChange",function(a){return c(d),_(n.venta.tipo_comprobante,a)||(n.venta.tipo_comprobante=a),p(a)}),e(30,"option"),i(31,"Boleta"),t(),e(32,"option"),i(33,"Factura"),t(),e(34,"option"),i(35,"No desea"),t()()(),e(36,"div")(37,"label",15),i(38,"N\xB0 Comprobante"),t(),e(39,"input",20),f("ngModelChange",function(a){return c(d),_(n.venta.nro_comprobante,a)||(n.venta.nro_comprobante=a),p(a)}),t()(),e(40,"div")(41,"label",15),i(42,"M\xE9todo de pago"),t(),e(43,"select",21),f("ngModelChange",function(a){return c(d),_(n.venta.metodo_pago,a)||(n.venta.metodo_pago=a),p(a)}),e(44,"option"),i(45,"Efectivo"),t(),e(46,"option"),i(47,"Tarjeta"),t(),e(48,"option"),i(49,"Transferencia"),t(),e(50,"option"),i(51,"Yape"),t(),e(52,"option"),i(53,"Plin"),t()()()()(),e(54,"div",9)(55,"div",10),h(),e(56,"svg",11),S(57,"path",22),t(),y(),e(58,"span"),i(59,"AGREGAR PRODUCTO"),t()()(),e(60,"section",13)(61,"div",23)(62,"div",24)(63,"div",25),i(64,"Producto"),t(),e(65,"div",26),i(66,"Cantidad"),t(),e(67,"div",26),i(68,"Descuento (S/.)"),t(),S(69,"div",27),t(),e(70,"div",28)(71,"div",25)(72,"select",29),f("ngModelChange",function(a){return c(d),_(n.formProducto.id_producto,a)||(n.formProducto.id_producto=a),p(a)}),e(73,"option",30),i(74,"Producto"),t(),v(75,Z,2,3,"option",18),t()(),e(76,"div",27)(77,"input",31),f("ngModelChange",function(a){return c(d),_(n.formProducto.cantidad,a)||(n.formProducto.cantidad=a),p(a)}),t()(),e(78,"div",27)(79,"input",32),f("ngModelChange",function(a){return c(d),_(n.formProducto.descuento,a)||(n.formProducto.descuento=a),p(a)}),t()(),e(80,"div",33)(81,"button",34),x("click",function(){return c(d),p(n.agregarProducto())}),e(82,"span"),i(83,"+"),t(),i(84," Agregar "),t()()()()(),e(85,"div",9)(86,"div",10),h(),e(87,"svg",11),S(88,"path",6),t(),y(),e(89,"span"),i(90,"CARRITO"),t()(),e(91,"div",35)(92,"div",36),i(93,"Total"),t(),e(94,"div",37),i(95),t()()(),e(96,"section",38),v(97,ee,17,1,"table",39)(98,te,5,0,"ng-template",null,0,F),t(),e(100,"div",40)(101,"div",41)(102,"label",42),i(103,"\xBFAplicar IGV (18%)?"),t(),e(104,"select",43),f("ngModelChange",function(a){return c(d),_(n.incluirIGV,a)||(n.incluirIGV=a),p(a)}),x("change",function(){return c(d),p(n.calcularTotal())}),e(105,"option",44),i(106,"No"),t(),e(107,"option",44),i(108,"S\xED"),t()(),v(109,ie,5,0,"div",45),t(),e(110,"div",46)(111,"div",47)(112,"span"),i(113,"Base Imponible"),t(),e(114,"span"),i(115),t()(),e(116,"div",47)(117,"span"),i(118,"IGV (18%)"),t(),e(119,"span"),i(120),t()(),e(121,"div",48)(122,"span"),i(123,"Total"),t(),e(124,"span",49),i(125),t()()()(),e(126,"div",50)(127,"button",51),x("click",function(){return c(d),p(n.limpiarVenta())}),i(128," Limpiar "),t(),e(129,"button",52),x("click",function(){return c(d),p(n.procesarVenta())}),i(130," Procesar Venta "),t(),e(131,"button",53),x("click",function(){return c(d),p(n.generarComprobantePDF())}),i(132," Generar Comprobante "),t()()()}if(o&2){let d=T(99);l(22),b("ngModel",n.venta.id_cliente),l(),u("value",0),l(2),u("ngForOf",n.clientes),l(4),b("ngModel",n.venta.tipo_comprobante),l(10),b("ngModel",n.venta.nro_comprobante),l(4),b("ngModel",n.venta.metodo_pago),l(29),b("ngModel",n.formProducto.id_producto),l(3),u("ngForOf",n.productos),l(2),b("ngModel",n.formProducto.cantidad),l(2),b("ngModel",n.formProducto.descuento),l(16),g(" S/. ",(n.venta.total||0).toFixed(2)," "),l(2),u("ngIf",n.carrito.length)("ngIfElse",d),l(7),b("ngModel",n.incluirIGV),l(),u("ngValue",!1),l(2),u("ngValue",!0),l(2),u("ngIf",n.incluirIGV&&n.venta.tipo_comprobante==="No desea"),l(6),g("S/. ",(n.base_imponible||0).toFixed(2),""),l(5),g("S/. ",(n.igv||0).toFixed(2),""),l(5),g("S/. ",(n.venta.total||0).toFixed(2),""),l(6),u("disabled",n.venta.tipo_comprobante==="No desea")}},dependencies:[D,N,W,z,j,R,A,O,L,B,H,G],encapsulation:2})};export{Q as PosComponent};
