import{a as W}from"./chunk-3S6KNALJ.js";import{c as L,f as j,i as P,j as B,k as G,p as z}from"./chunk-BIJEMQVT.js";import{a as H}from"./chunk-O5HRWX2F.js";import{$a as T,Db as A,Eb as O,Ga as m,Hb as D,Ia as l,Ka as R,Ma as t,Na as i,O as I,Oa as f,Pa as M,Qa as N,Ra as x,T as C,W as U,Wa as n,Xa as b,Ya as h,ab as V,bb as k,ca as S,da as _,db as F,ea as c,fa as g,wa as a,xa as y}from"./chunk-SFQMZB6G.js";import{a as w,b as E,h as d}from"./chunk-FK42CRUA.js";var v=class r{constructor(o){this.supabase=o}TABLE="roles";getRoles(){return d(this,null,function*(){let{data:o,error:e}=yield this.supabase.client.from(this.TABLE).select("*").order("id_rol",{ascending:!0});if(e)throw e;return o})}static \u0275fac=function(e){return new(e||r)(C(H))};static \u0275prov=I({token:r,factory:r.\u0275fac,providedIn:"root"})};function K(r,o){r&1&&(t(0,"div",9)(1,"div",10),n(2,"Cargando usuarios..."),i()())}function Q(r,o){r&1&&(t(0,"div",11),c(),t(1,"svg",12),f(2,"path",3),i(),g(),t(3,"p",13),n(4,"No hay usuarios registrados"),i(),t(5,"p",14),n(6,"Los usuarios aparecer\xE1n aqu\xED cuando se registren"),i()())}function X(r,o){r&1&&(t(0,"span",34),n(1," SUPERADMIN "),i())}function Y(r,o){if(r&1&&(t(0,"option",29),n(1),i()),r&2){let e=o.$implicit;l("ngValue",e.id_rol),a(),h(" ",e.nombre_rol," ")}}function Z(r,o){if(r&1){let e=M();t(0,"tr",21)(1,"td",22)(2,"div",23)(3,"span",24),n(4),i(),m(5,X,2,0,"span",25),i()(),t(6,"td",26),n(7),i(),t(8,"td",26),n(9),i(),t(10,"td",22)(11,"span",27),n(12),i()(),t(13,"td",22)(14,"select",28),k("ngModelChange",function(u){let p=S(e).$implicit;return V(p.id_rol,u)||(p.id_rol=u),_(u)}),t(15,"option",29),n(16,"SIN ROL"),i(),m(17,Y,2,2,"option",30),i()(),t(18,"td",22)(19,"button",31),N("click",function(){let u=S(e).$implicit,p=x(2);return _(p.guardarRol(u))}),c(),t(20,"svg",32),f(21,"path",33),i(),g(),t(22,"span"),n(23,"Guardar"),i()()()()}if(r&2){let e=o.$implicit,s=x(2);a(4),b(e.nombre_usuario),a(),l("ngIf",e.esSuperadmin===!0),a(2),b(e.nombre||"\u2014"),a(2),b(e.apellido||"\u2014"),a(2),R("bg-purple-100",e.esSuperadmin===!0)("text-purple-800",e.esSuperadmin===!0)("bg-blue-100",(e.roles==null?null:e.roles.nombre_rol)&&e.esSuperadmin!==!0)("text-blue-700",(e.roles==null?null:e.roles.nombre_rol)&&e.esSuperadmin!==!0)("bg-gray-100",!(e.roles!=null&&e.roles.nombre_rol))("text-gray-600",!(e.roles!=null&&e.roles.nombre_rol)),a(),h(" ",e.esSuperadmin===!0?"SUPERADMIN":(e.roles==null?null:e.roles.nombre_rol)||"SIN ROL"," "),a(2),T("ngModel",e.id_rol),l("disabled",e.esSuperadmin===!0),a(),l("ngValue",null),a(2),l("ngForOf",s.roles),a(2),l("disabled",e.esSuperadmin===!0)}}function ee(r,o){if(r&1&&(t(0,"div",15)(1,"table",16)(2,"thead",17)(3,"tr")(4,"th",18),n(5,"Usuario"),i(),t(6,"th",18),n(7,"Nombre"),i(),t(8,"th",18),n(9,"Apellido"),i(),t(10,"th",18),n(11,"Rol Actual"),i(),t(12,"th",18),n(13,"Asignar Rol"),i(),t(14,"th",18),n(15,"Acci\xF3n"),i()()(),t(16,"tbody",19),m(17,Z,24,22,"tr",20),i()()()),r&2){let e=x();a(17),l("ngForOf",e.usuarios)}}var $=class r{constructor(o,e){this.usuariosService=o;this.rolesService=e}usuarios=[];roles=[];loading=!0;SUPERADMIN_ID="e3a3f8f6-ded6-45fa-a2e3-5d873e6fab34";ngOnInit(){return d(this,null,function*(){yield this.cargarRoles(),yield this.cargarUsuarios()})}cargarRoles(){return d(this,null,function*(){this.roles=yield this.rolesService.getRoles()})}cargarUsuarios(){return d(this,null,function*(){this.loading=!0;let o=yield this.usuariosService.getUsuarios();this.usuarios=o.map(e=>E(w({},e),{esSuperadmin:e.id_usuario===this.SUPERADMIN_ID})),this.loading=!1})}guardarRol(o){return d(this,null,function*(){if(o.esSuperadmin){alert("\u26A0\uFE0F El superadmin no puede cambiar de rol.");return}try{yield this.usuariosService.actualizarRolUsuario(o.id_usuario,o.id_rol??null),alert("Rol actualizado correctamente");let e=localStorage.getItem("user_id");e&&e===o.id_usuario&&console.warn("Has cambiado tu propio rol. Vuelve a iniciar sesi\xF3n para aplicar cambios.")}catch(e){console.error(e),alert("Error al actualizar rol")}})}static \u0275fac=function(e){return new(e||r)(y(W),y(v))};static \u0275cmp=U({type:r,selectors:[["app-usuarios"]],standalone:!0,features:[F],decls:12,vars:3,consts:[[1,"p-4","md:p-6","space-y-6"],[1,"text-2xl","font-bold","text-gray-800","flex","items-center","gap-3"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","text-blue-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"],[1,"text-gray-600","mt-1"],[1,"bg-white","p-5","rounded-xl","shadow-sm","border","border-gray-200"],["class","flex items-center justify-center py-12",4,"ngIf"],["class","text-center py-12",4,"ngIf"],["class","overflow-x-auto",4,"ngIf"],[1,"flex","items-center","justify-center","py-12"],[1,"text-sm","text-gray-500"],[1,"text-center","py-12"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-16","h-16","mx-auto","mb-4","text-gray-400"],[1,"text-sm","font-medium","text-gray-500"],[1,"text-xs","text-gray-400","mt-1"],[1,"overflow-x-auto"],[1,"w-full","min-w-[1000px]","border-collapse"],[1,"bg-gray-100","text-sm","text-gray-600"],[1,"px-4","py-3","text-left","font-semibold"],[1,"text-sm"],["class","border-b hover:bg-gray-50 transition-colors",4,"ngFor","ngForOf"],[1,"border-b","hover:bg-gray-50","transition-colors"],[1,"px-4","py-3"],[1,"flex","items-center","gap-2"],[1,"font-semibold","text-gray-900"],["class","px-2 py-0.5 text-[10px] font-bold rounded-full bg-purple-100 text-purple-700 border border-purple-300",4,"ngIf"],[1,"px-4","py-3","text-gray-700"],[1,"px-2.5","py-1","rounded-full","text-xs","font-medium"],[1,"w-full","px-3","py-2","rounded-lg","border","border-gray-300","bg-white","text-gray-900","outline-none","text-sm","focus:ring-2","focus:ring-blue-500","focus:border-blue-500","disabled:bg-gray-100","disabled:cursor-not-allowed",3,"ngModelChange","ngModel","disabled"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["title","Guardar rol",1,"inline-flex","items-center","gap-2","px-4","py-2","rounded-lg","bg-blue-600","text-white","font-medium","text-sm","hover:bg-blue-700","transition-colors","shadow-sm","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],[1,"px-2","py-0.5","text-[10px]","font-bold","rounded-full","bg-purple-100","text-purple-700","border","border-purple-300"]],template:function(e,s){e&1&&(t(0,"div",0)(1,"div")(2,"h1",1),c(),t(3,"svg",2),f(4,"path",3),i(),n(5," Gesti\xF3n de Usuarios y Roles "),i(),g(),t(6,"p",4),n(7,"Administra usuarios y asigna roles del sistema."),i()(),t(8,"div",5),m(9,K,3,0,"div",6)(10,Q,7,0,"div",7)(11,ee,18,1,"div",8),i()()),e&2&&(a(9),l("ngIf",s.loading),a(),l("ngIf",!s.loading&&s.usuarios.length===0),a(),l("ngIf",!s.loading&&s.usuarios.length>0))},dependencies:[D,A,O,z,B,G,P,L,j],encapsulation:2})};export{$ as UsuariosComponent};
